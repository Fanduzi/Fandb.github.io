<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>redis-cli,redis命令行界面 | Fan()</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Redisredis-cli" />
  
  
  
  
  <meta name="description" content="redis-cli,Redis命令行界面redis-cli是Redis命令行界面，一个简单的程序，允许向Redis发送命令，并直接从终端读取服务器发送的回复。 它有两种主要的模式：一种是交互模式，在这种模式下，用户输入命令并获得回复的REPL（Read Eval Print Loop）另一种模式是将命令作为redis-cli的参数发送，执行并打印在标准输出上。 在交互模式下，redis-cli具有">
<meta property="og:type" content="article">
<meta property="og:title" content="redis-cli,Redis命令行界面">
<meta property="og:url" content="http://fuxkdb.com/2018/01/18/redis-cli/index.html">
<meta property="og:site_name" content="Fan()">
<meta property="og:description" content="redis-cli,Redis命令行界面redis-cli是Redis命令行界面，一个简单的程序，允许向Redis发送命令，并直接从终端读取服务器发送的回复。 它有两种主要的模式：一种是交互模式，在这种模式下，用户输入命令并获得回复的REPL（Read Eval Print Loop）另一种模式是将命令作为redis-cli的参数发送，执行并打印在标准输出上。 在交互模式下，redis-cli具有">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-01-17T16:00:00.000Z">
<meta property="article:modified_time" content="2018-01-18T12:04:24.000Z">
<meta property="article:author" content="大范">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="redis-cli">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Fan()" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpeg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpeg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    
<link rel="stylesheet" href="/css/dialog.css">

  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 6.2.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpeg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-redis-cli" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      redis-cli,Redis命令行界面
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/01/18/redis-cli/" class="article-date">
	  <time datetime="2018-01-17T16:00:00.000Z" itemprop="datePublished">2018-01-18</time>
	</a>

      
      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="redis-cli-Redis命令行界面"><a href="#redis-cli-Redis命令行界面" class="headerlink" title="redis-cli,Redis命令行界面"></a>redis-cli,Redis命令行界面</h1><p>redis-cli是Redis命令行界面，一个简单的程序，允许向Redis发送命令，并直接从终端读取服务器发送的回复。</p>
<p>它有两种主要的模式：一种是交互模式，在这种模式下，用户输入命令并获得回复的REPL（Read Eval Print Loop）另一种模式是将命令作为redis-cli的参数发送，执行并打印在标准输出上。</p>
<p>在交互模式下，redis-cli具有基本的行编辑功能，可以提供良好的打字体验。</p>
<p>但是，redis-cli不只是这一点。有些选项可以用来启动程序，以便将其放入特殊模式，以便redis-cli可以完成更复杂的任务，例如模拟slave并打印从master接收到的复制流，查看复制延迟，并显示统计数据，甚至一个ASCII艺术频谱图的延迟样本和频率，以及许多其他事情。</p>
<p>本指南将涵盖redis-cli的不同方面，由简入繁。</p>
<p>如果您要广泛使用Redis，或者您已经这么做了，那么很可能会碰巧使用redis-cli。花一些时间来熟悉它可能是一个非常好的主意，一旦你知道了命令行界面的所有技巧，你就会看到你将更有效地使用Redis。</p>
<h1 id="命令行用法"><a href="#命令行用法" class="headerlink" title="命令行用法"></a>命令行用法</h1><p>如下可以直接非交互模式执行命令并在标准输出获取返回结果<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli incr mycounter</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p>‘()’内为返回结果的类型.当我们需要获取返回结果作为下一个命令的输入,或者希望将结果重定向到文件中时,我们可能不需要显示类型信息.<br>实际上,redis-cli会自动检测,当它检测到标准输出是一个tty(a terminal basically)时,它会显示类型信息来提升可读性,否则它会启用原始输出模式,如下所示:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli incr mycounter &gt; <span class="regexp">/tmp/</span>output.txt</span><br><span class="line">$ cat <span class="regexp">/tmp/</span>output.txt</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure><br>这一次当CLI检测到输出不在写入terminal后,(integer)被删除了不再显示. 你可以使用<code>--raw</code>选项来强制输出到终端的内容也不显示类型信息<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli <span class="comment">--raw incr mycounter</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure></p>
<p>同样的,你也可以使用<code>--no-raw</code>强制非tty输出也显示类型信息<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> incr no</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> --raw incr no</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> incr no &gt; res.txt</span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# cat res.txt </span><br><span class="line"><span class="number">3</span></span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> --no-raw incr no &gt; res.txt</span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# cat res.txt </span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">4</span></span><br></pre></td></tr></table></figure><br><a id="more"></a></p>
<h2 id="Host-port-password-and-database"><a href="#Host-port-password-and-database" class="headerlink" title="Host, port, password and database"></a>Host, port, password and database</h2><p>redis-cli默认会连接127.0.0.1,6379端口.可以使用<code>-h</code> 和 <code>-p</code>选项更改host和port<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h redis15.localnet.org -p 6390 ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><br>如果你的instance设置了密码,可以使用<code>-a</code>选项<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -a myUnguessablePazzzzzword123 ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure></p>
<p>可以使用<code>-n</code>选项修改database<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli flushall</span><br><span class="line">OK</span><br><span class="line">$ redis-cli -n <span class="number">1</span> incr a</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line">$ redis-cli -n <span class="number">1</span> incr a</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">2</span></span><br><span class="line">$ redis-cli -n <span class="number">2</span> incr a</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>Some or all of this information can also be provided by using the -u <uri> option and a valid URI:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -<span class="keyword">u</span> <span class="keyword">redi</span><span class="variable">s:</span>//<span class="keyword">p</span>%<span class="number">40</span>ssw0rd@redis-<span class="number">16379</span>.hosted.<span class="keyword">com</span>:<span class="number">16379</span>/<span class="number">0</span> ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>3.2.9没这个</p>
</blockquote>
<h2 id="Getting-input-from-other-programs"><a href="#Getting-input-from-other-programs" class="headerlink" title="Getting input from other programs"></a>Getting input from other programs</h2><p>有两种方法可以使用redis-cli来获得来自其他命令的输入.一种是从标准输入stdin读取最后一个argument.例如,set 一个key的值为/etc/services<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@cn_mu_binlog_backup ~]# less /etc/services</span><br><span class="line"><span class="comment"># /etc/services:</span></span><br><span class="line"><span class="comment"># $Id: services,v 1.48 2009/11/11 14:32:31 ovasik Exp $</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Network services, Internet style</span></span><br><span class="line"><span class="comment"># IANA services version: last updated 2009-11-10</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that it is presently the policy of IANA to assign a single well-known</span></span><br><span class="line"><span class="comment"># port number for both TCP and UDP; hence, most entries here have two entries</span></span><br><span class="line"><span class="comment"># even if the protocol doesn&#x27;t support UDP operations.</span></span><br><span class="line"><span class="comment"># Updated from RFC 1700, ``Assigned Numbers&#x27;&#x27; (October 1994).  Not all ports</span></span><br><span class="line"><span class="comment"># are included, only the more common ones.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The latest IANA port assignments can be gotten from</span></span><br><span class="line"><span class="comment">#       http://www.iana.org/assignments/port-numbers</span></span><br><span class="line"><span class="comment"># The Well Known Ports are those from 0 through 1023.</span></span><br><span class="line"><span class="comment"># The Registered Ports are those from 1024 through 49151</span></span><br><span class="line"><span class="comment"># The Dynamic and/or Private Ports are those from 49152 through 65535</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Each line describes one service, and is of the form:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># service-name  port/protocol  [aliases ...]   [# comment]</span></span><br><span class="line"></span><br><span class="line">tcpmux          1/tcp                           # TCP<span class="built_in"> port service </span>multiplexer</span><br><span class="line">tcpmux          1/udp                           # TCP<span class="built_in"> port service </span>multiplexer</span><br><span class="line">rje             5/tcp                           # Remote Job Entry</span><br><span class="line">rje             5/udp                           # Remote Job Entry</span><br><span class="line">echo            7/tcp</span><br></pre></td></tr></table></figure><br>可以使用<code>-x</code>选项<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> -x <span class="keyword">set</span> foo &lt; /etc/services </span><br><span class="line">OK</span><br><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> getrange foo <span class="number">0</span> <span class="number">50</span></span><br><span class="line"><span class="string">&quot;# /etc/services:\n# $Id: services,v 1.48 2009/11/11 &quot;</span></span><br></pre></td></tr></table></figure></p>
<p>正如你可以在上面的会话的第一行看到的那样,没有指定SET命令的最后一个参数.<br>而是指定-x选项,并将文件重定向到CLI的标准输入. 所以输入被读取,并被用作命令的最后一个参数. 这对编写脚本很有用.</p>
<p>一个不同的方法是向redis-cli提供一个写在文本文件中的命令列表:<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> cat /tmp/commands.txt</span><br><span class="line"><span class="keyword">set</span> foo <span class="comment">100</span></span><br><span class="line">incr <span class="comment">foo</span></span><br><span class="line">append <span class="comment">foo xxx</span></span><br><span class="line">get <span class="comment">foo</span></span><br><span class="line">$ cat /tmp/<span class="comment">commands.txt</span> |<span class="comment"> redis-cli</span></span><br><span class="line">OK</span><br><span class="line">(integer) 101</span><br><span class="line">(integer) 6</span><br><span class="line"><span class="string">&quot;101xxx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ cat /tmp/<span class="comment">commands.txt</span></span><br><span class="line"><span class="keyword">set</span> <span class="comment">foo 100</span></span><br><span class="line">incr <span class="comment">foo</span></span><br><span class="line">append <span class="comment">foo xxx</span></span><br><span class="line">get <span class="comment">foo</span></span><br><span class="line">$ cat /tmp/<span class="comment">commands.txt</span> |<span class="comment"> redis-cli</span></span><br><span class="line">OK</span><br><span class="line">(integer) 101</span><br><span class="line">(integer) 6</span><br><span class="line"><span class="string">&quot;101xxx&quot;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>中间有错误会继续执行</p>
</blockquote>
<h2 id="持续运行相同的命令"><a href="#持续运行相同的命令" class="headerlink" title="持续运行相同的命令"></a>持续运行相同的命令</h2><p><code>-r</code></p>
<blockquote>
<p>Execute specified command N times.</p>
</blockquote>
<p><code>-i</code></p>
<blockquote>
<p>When -r is used, waits <interval> seconds per command.<br>It is possible to specify sub-second times like -i 0.1.</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -p 6381 -r 5 -i 1 ping</span><br><span class="line">PONG</span><br><span class="line">PONG</span><br><span class="line">PONG</span><br><span class="line">PONG</span><br><span class="line"><span class="built_in">..</span>.</span><br></pre></td></tr></table></figure>
<h2 id="使用redis-cli批量插入数据"><a href="#使用redis-cli批量插入数据" class="headerlink" title="使用redis-cli批量插入数据"></a>使用redis-cli批量插入数据</h2><p>使用redis-cli进行批量插入会被分离出来，因为它本身就是一个有价值的话题。 请参阅我们的<a target="_blank" rel="noopener" href="http://www.redis.cn/topics/mass-insert">批量插入指南</a>.</p>
<h2 id="CSV格式输出"><a href="#CSV格式输出" class="headerlink" title="CSV格式输出"></a>CSV格式输出</h2><p><code>--csv</code></p>
<blockquote>
<p>Output in CSV format.</p>
</blockquote>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli lpush mylist a b c d</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line">$ redis-cli --csv <span class="keyword">lrange</span> mylist <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="string">&quot;d&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="执行lua脚本"><a href="#执行lua脚本" class="headerlink" title="执行lua脚本"></a>执行lua脚本</h2><p>redis-cli对使用Lua脚本的新Lua调试工具提供了广泛的支持，从Redis 3.2开始。 有关此功能，请参阅Redis Lua调试器文档。</p>
<p>但是，即使不使用调试器，与以交互方式将脚本键入到shell或作为参数相比，您可以使用redis-cli以更舒适的方式从文件运行脚本：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">cat</span> /tmp/script.<span class="keyword">lua</span></span><br><span class="line"><span class="keyword">return</span> redis.<span class="keyword">call</span>(<span class="string">&#x27;set&#x27;</span>,KEYS[<span class="number">1</span>],ARGV[<span class="number">1</span>])</span><br><span class="line">$ redis-cli --<span class="built_in">eval</span> /tmp/script.<span class="keyword">lua</span> foo , bar</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -<span class="keyword">p</span> <span class="number">6381</span> --<span class="built_in">eval</span> ./script.<span class="keyword">lua</span> foo , bar  # foo空格,空格bar</span><br><span class="line">OK</span><br><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -<span class="keyword">p</span> <span class="number">6381</span> <span class="built_in">get</span> foo</span><br><span class="line"><span class="string">&quot;bar&quot;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Interactive-mode-交互模式"><a href="#Interactive-mode-交互模式" class="headerlink" title="Interactive mode 交互模式"></a>Interactive mode 交互模式</h1><p>到目前为止，我们探讨了如何使用Redis CLI作为命令行程序。 这对于脚本和某些类型的测试非常有用，但是大多数人将大部分时间都花在使用交互模式的redis-cli上。</p>
<p>在交互模式下，用户在提示符下键入Redis命令。 该命令被发送到服务器，进行处理，回复被解析并呈现为更简单的形式来读取。</p>
<p>在交互模式下运行CLI并不需要什么特别的东西 - 只要在没有任何争论的情况下进行午餐就可以了：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>
<p><code>127.0.0.1:6379&gt;</code>是提示符,提示你连接server和database. 当改变server或选择其他非0database时提示符会改变</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; select <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>[<span class="number">2</span>]&gt; dbsize</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>[<span class="number">2</span>]&gt; select <span class="number">0</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; dbsize</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">503</span></span><br></pre></td></tr></table></figure>
<h2 id="处理连接和重新连接"><a href="#处理连接和重新连接" class="headerlink" title="处理连接和重新连接"></a>处理连接和重新连接</h2><p>connect命令,指定hostname和port即可连接另一个instance<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; connect <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6380</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; </span><br></pre></td></tr></table></figure></p>
<p>正如你所看到的提示相应地改变。 如果用户尝试连接到不可访问的实例，则redis-cli将进入断开连接模式，并尝试在执行每个新命令时重新连接：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; connect 127.0.0.1 9999</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis at 127.0.0.1:9999:<span class="built_in"> Connection </span>refused</span><br><span class="line"><span class="keyword">not</span> connected&gt; ping</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis at 127.0.0.1:9999:<span class="built_in"> Connection </span>refused</span><br><span class="line"><span class="keyword">not</span> connected&gt; ping</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis at 127.0.0.1:9999:<span class="built_in"> Connection </span>refused</span><br><span class="line"><span class="keyword">not</span> connected&gt; </span><br></pre></td></tr></table></figure></p>
<p>通常在检测到断开连接后，CLI始终尝试重新连接：如果尝试失败，则显示错误并进入断开连接状态。 以下是断开和重新连接的示例：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="builtin-name">debug</span> restart</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis at 127.0.0.1:6379:<span class="built_in"> Connection </span>refused</span><br><span class="line"><span class="keyword">not</span> connected&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; (now we are connected again)</span><br></pre></td></tr></table></figure></p>
<p>重新连接时，redis-cli会自动重新选择最后一个选择的数据库编号。 然而，关于连接的所有其他状态都会丢失，例如，如果我们处于中间状态，<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; multi  --标记一个事物开始</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">( here the<span class="built_in"> server </span>is manually restarted )</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(error) ERR EXEC without MULTI</span><br></pre></td></tr></table></figure></p>
<p>在交互模式下使用CLI进行测试时，这通常不是问题，但您应该知道这个限制。</p>
<h2 id="Editing-history-and-completion"><a href="#Editing-history-and-completion" class="headerlink" title="Editing, history and completion"></a>Editing, history and completion</h2><p>由于redis-cli使用linenoise行编辑库，因此它总是具有行编辑功能，而不依赖libreadline或其他可选库。</p>
<p>您可以访问已执行的命令的历史记录，以便通过按方向键（向上和向下）来避免重复输入它们。 在通过HOME环境变量指定的用户主目录内的.rediscli_history文件中，CLI的重新启动之间保存历史记录。 可以通过设置REDISCLI_HISTFILE环境变量来使用不同的历史文件名，并通过将其设置为/dev/null来禁用它。</p>
<p>CLI也可以通过按TAB键执行命令补全，如下例所示：<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; Z&lt;TAB&gt;</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; ZADD&lt;TAB&gt;</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; ZCARD&lt;TAB&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="Running-the-same-command-N-times"><a href="#Running-the-same-command-N-times" class="headerlink" title="Running the same command N times"></a>Running the same command N times</h2><p>可以通过在命令名前添加一个数字来多次运行相同的命令：<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="number">5</span> incr mycounter</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">2</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">3</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">4</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Showing-help-about-Redis-commands"><a href="#Showing-help-about-Redis-commands" class="headerlink" title="Showing help about Redis commands"></a>Showing help about Redis commands</h2><p>Redis has a number of commands and sometimes, as you test things, you may not remember the exact order of arguments. redis-cli provides online help for most Redis commands, using the help command. The command can be used in two forms:</p>
<p>help @<category> shows all the commands about a given category. The categories are: @generic, @list, @set, @sorted_set, @hash, @pubsub, @transactions, @connection, @server, @scripting, @hyperloglog.<br>help <commandname> shows specific help for the command given as argument.<br>For example in order to show help for the PFADD command, use:</p>
<p>127.0.0.1:6379&gt; help PFADD</p>
<p>PFADD key element [element …] summary: Adds the specified elements to the specified HyperLogLog. since: 2.8.9</p>
<p>Note that help supports TAB completion as well.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6381&gt;</span> <span class="string">help</span> <span class="string">@set</span></span><br><span class="line"></span><br><span class="line">  <span class="string">SADD</span> <span class="string">key</span> <span class="string">member</span> [<span class="string">member</span> <span class="string">...</span>]</span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Add</span> <span class="string">one</span> <span class="string">or</span> <span class="string">more</span> <span class="string">members</span> <span class="string">to</span> <span class="string">a</span> <span class="string">set</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">  <span class="string">SCARD</span> <span class="string">key</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">number</span> <span class="string">of</span> <span class="string">members</span> <span class="string">in</span> <span class="string">a</span> <span class="string">set</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">  <span class="string">SDIFF</span> <span class="string">key</span> [<span class="string">key</span> <span class="string">...</span>]</span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Subtract</span> <span class="string">multiple</span> <span class="string">sets</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">  <span class="string">SDIFFSTORE</span> <span class="string">destination</span> <span class="string">key</span> [<span class="string">key</span> <span class="string">...</span>]</span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Subtract</span> <span class="string">multiple</span> <span class="string">sets</span> <span class="string">and</span> <span class="string">store</span> <span class="string">the</span> <span class="string">resulting</span> <span class="string">set</span> <span class="string">in</span> <span class="string">a</span> <span class="string">key</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<h2 id="Clearing-the-terminal-screen-清屏"><a href="#Clearing-the-terminal-screen-清屏" class="headerlink" title="Clearing the terminal screen 清屏"></a>Clearing the terminal screen 清屏</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">clear</span></span><br></pre></td></tr></table></figure>
<h1 id="特殊的操作模式"><a href="#特殊的操作模式" class="headerlink" title="特殊的操作模式"></a>特殊的操作模式</h1><p>至此我们见识了redis-cli的两种主要模式</p>
<ul>
<li>Redis命令的命令行执行。</li>
<li>交互式的“类似REPL”的用法。</li>
</ul>
<p>However the CLI performs other auxiliary tasks related to Redis that are explained in the next sections:</p>
<ul>
<li>Monitoring tool to show continuous stats about a Redis server. 监控工具</li>
<li>Scanning a Redis database for very large keys. 扫描database找出very large key</li>
<li>Key space scanner with pattern matching. 模式匹配扫描</li>
<li>Acting as a Pub/Sub client to subscribe to channels. 作为Pub/Sub client订阅频道</li>
<li>Monitoring the commands executed into a Redis instance. 监视执行到Redis实例中的命令</li>
<li>Checking the latency of a Redis server in different ways. 以不同的方式检查Redis服务器的延迟</li>
<li>Checking the scheduler latency of the local computer. 检查本地计算机的调度程序延迟</li>
<li>Transferring RDB backups from a remote Redis server locally. 从远程Redis服务器传输RDB备份到本地</li>
<li>Acting as a Redis slave for showing what a slave receives. 扮演Redis的slave,展示slave所接受的东西</li>
<li>Simulating LRU workloads for showing stats about keys hits. 模拟LRU工作负载显示有关keys命中的统计信息</li>
<li>A client for the Lua debugger.</li>
</ul>
<h2 id="Continuous-stats-mode"><a href="#Continuous-stats-mode" class="headerlink" title="Continuous stats mode"></a>Continuous stats mode</h2><p>这可能是redis-cli的一个鲜为人知的特性之一，并且为了实时监控Redis实例非常有用。 要启用此模式，使用<code>--stat</code>选项。 在这种模式下，CLI的行为输出内容显而易见：<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli --stat</span><br><span class="line">------- data ------ --------------------- load -------------------- - child -</span><br><span class="line">keys       mem      clients blocked requests            connections</span><br><span class="line"><span class="number">506</span>        <span class="number">1015.00</span>K <span class="number">1</span>       <span class="number">0</span>       <span class="number">24</span> (+<span class="number">0</span>)             <span class="number">7</span></span><br><span class="line"><span class="number">506</span>        <span class="number">1015.00</span>K <span class="number">1</span>       <span class="number">0</span>       <span class="number">25</span> (+<span class="number">1</span>)             <span class="number">7</span></span><br><span class="line"><span class="number">506</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">60461</span> (+<span class="number">60436</span>)      <span class="number">57</span></span><br><span class="line"><span class="number">506</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">146425</span> (+<span class="number">85964</span>)     <span class="number">107</span></span><br><span class="line"><span class="number">507</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">233844</span> (+<span class="number">87419</span>)     <span class="number">157</span></span><br><span class="line"><span class="number">507</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">321715</span> (+<span class="number">87871</span>)     <span class="number">207</span></span><br><span class="line"><span class="number">508</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">408642</span> (+<span class="number">86927</span>)     <span class="number">257</span></span><br><span class="line"><span class="number">508</span>        <span class="number">3.40</span>M    <span class="number">51</span>      <span class="number">0</span>       <span class="number">497038</span> (+<span class="number">88396</span>)     <span class="number">257</span></span><br></pre></td></tr></table></figure></p>
<p>在这种模式下，每秒钟都会打印一行新的信息，并显示旧数据点之间的差异。 您可以轻松了解内存使用情况，连接的客户端等情况。</p>
<p>在这种情况下，<code>-i &lt;间隔&gt;</code>选项作为修改interval。 默认是一秒钟。</p>
<h2 id="Scanning-for-big-keys"><a href="#Scanning-for-big-keys" class="headerlink" title="Scanning for big keys"></a>Scanning for big keys</h2><p>在这个特殊的模式下，redis-cli作为一个关键的空间分析器。 它扫描大键的数据集，但也提供有关数据集组成的数据类型的信息。 使用<code>--bigkeys</code>选项启用此模式，并生成相当详细的输出：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli <span class="comment">--bigkeys</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Scanning the entire keyspace to find biggest keys as well as</span></span><br><span class="line"><span class="comment"># average sizes per key type.  You can use -i 0.1 to sleep 0.1 sec</span></span><br><span class="line"><span class="comment"># per 100 SCAN commands (not usually needed).</span></span><br><span class="line"></span><br><span class="line">[00.00%] Biggest string found so far &#x27;key-419&#x27; <span class="keyword">with</span> <span class="number">3</span> <span class="keyword">bytes</span></span><br><span class="line">[<span class="number">05.14</span>%] Biggest <span class="keyword">list</span>   <span class="keyword">found</span> so <span class="keyword">far</span> <span class="string">&#x27;mylist&#x27;</span> <span class="keyword">with</span> <span class="number">100004</span> items</span><br><span class="line">[<span class="number">35.77</span>%] Biggest <span class="keyword">string</span> <span class="keyword">found</span> so <span class="keyword">far</span> <span class="string">&#x27;counter:__rand_int__&#x27;</span> <span class="keyword">with</span> <span class="number">6</span> <span class="keyword">bytes</span></span><br><span class="line">[<span class="number">73.91</span>%] Biggest <span class="keyword">hash</span>   <span class="keyword">found</span> so <span class="keyword">far</span> <span class="string">&#x27;myobject&#x27;</span> <span class="keyword">with</span> <span class="number">3</span> <span class="keyword">fields</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-------- summary -------</span></span><br><span class="line"></span><br><span class="line">Sampled <span class="number">506</span> <span class="keyword">keys</span> <span class="keyword">in</span> the keyspace!</span><br><span class="line">Total <span class="keyword">key</span> <span class="keyword">length</span> <span class="keyword">in</span> <span class="keyword">bytes</span> <span class="keyword">is</span> <span class="number">3452</span> (<span class="keyword">avg</span> <span class="keyword">len</span> <span class="number">6.82</span>)</span><br><span class="line"></span><br><span class="line">Biggest <span class="keyword">string</span> <span class="keyword">found</span> <span class="string">&#x27;counter:__rand_int__&#x27;</span> has <span class="number">6</span> <span class="keyword">bytes</span></span><br><span class="line">Biggest   <span class="keyword">list</span> <span class="keyword">found</span> <span class="string">&#x27;mylist&#x27;</span> has <span class="number">100004</span> items</span><br><span class="line">Biggest   <span class="keyword">hash</span> <span class="keyword">found</span> <span class="string">&#x27;myobject&#x27;</span> has <span class="number">3</span> <span class="keyword">fields</span></span><br><span class="line"></span><br><span class="line"><span class="number">504</span> strings <span class="keyword">with</span> <span class="number">1403</span> <span class="keyword">bytes</span> (<span class="number">99.60</span>% <span class="keyword">of</span> <span class="keyword">keys</span>, <span class="keyword">avg</span> <span class="keyword">size</span> <span class="number">2.78</span>)</span><br><span class="line"><span class="number">1</span> lists <span class="keyword">with</span> <span class="number">100004</span> items (<span class="number">00.20</span>% <span class="keyword">of</span> <span class="keyword">keys</span>, <span class="keyword">avg</span> <span class="keyword">size</span> <span class="number">100004.00</span>)</span><br><span class="line"><span class="number">0</span> <span class="keyword">sets</span> <span class="keyword">with</span> <span class="number">0</span> members (<span class="number">00.00</span>% <span class="keyword">of</span> <span class="keyword">keys</span>, <span class="keyword">avg</span> <span class="keyword">size</span> <span class="number">0.00</span>)</span><br><span class="line"><span class="number">1</span> hashs <span class="keyword">with</span> <span class="number">3</span> <span class="keyword">fields</span> (<span class="number">00.20</span>% <span class="keyword">of</span> <span class="keyword">keys</span>, <span class="keyword">avg</span> <span class="keyword">size</span> <span class="number">3.00</span>)</span><br><span class="line"><span class="number">0</span> zsets <span class="keyword">with</span> <span class="number">0</span> members (<span class="number">00.00</span>% <span class="keyword">of</span> <span class="keyword">keys</span>, <span class="keyword">avg</span> <span class="keyword">size</span> <span class="number">0.00</span>)</span><br></pre></td></tr></table></figure><br>在输出的第一部分中，报告每个大于前一个较大键（相同类型）的新键。 摘要部分提供有关Redis实例内数据的一般统计信息。</p>
<p>该程序使用SCAN命令，因此可以在繁忙的服务器上执行，而不会影响操作，但是可以使用<code>-i</code>选项来限制所请求的每个100个键的指定秒数的扫描进程。 例如，<code>-i 0.1</code>会减慢程序的执行速度，但也会将服务器上的负载减少到很小的数量。</p>
<p>请注意，摘要还会以更清晰的形式报告每次发现的最大密钥。 如果对一个非常大的数据集运行，最初的输出只是提供一些有趣的信息。</p>
<h2 id="Getting-a-list-of-keys"><a href="#Getting-a-list-of-keys" class="headerlink" title="Getting a list of keys"></a>Getting a list of keys</h2><p>也可以扫描key空间，再次以不阻塞Redis服务器的方式（当您使用诸如KEYS *之类的命令时发生这种情况），打印所有的键名，或者对特定的模式进行过滤。 与<code>-bigkeys</code>选项一样，此模式使用SCAN命令，因此，如果数据集正在更改，可能会多次报告键，但是如果从迭代开始以来存在该键，则不会丢失键。 由于它使用这个选项的命令叫做<code>--scan</code>。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli --scan | head <span class="number">-10</span></span><br><span class="line"><span class="type">key</span><span class="number">-419</span></span><br><span class="line"><span class="type">key</span><span class="number">-71</span></span><br><span class="line"><span class="type">key</span><span class="number">-236</span></span><br><span class="line"><span class="type">key</span><span class="number">-50</span></span><br><span class="line"><span class="type">key</span><span class="number">-38</span></span><br><span class="line"><span class="type">key</span><span class="number">-458</span></span><br><span class="line"><span class="type">key</span><span class="number">-453</span></span><br><span class="line"><span class="type">key</span><span class="number">-499</span></span><br><span class="line"><span class="type">key</span><span class="number">-446</span></span><br><span class="line"><span class="type">key</span><span class="number">-371</span></span><br></pre></td></tr></table></figure>
<p><code>--pattern</code>模式匹配<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli --scan --pattern &#x27;*<span class="number">-11</span>*&#x27;</span><br><span class="line"><span class="type">key</span><span class="number">-114</span></span><br><span class="line"><span class="type">key</span><span class="number">-117</span></span><br><span class="line"><span class="type">key</span><span class="number">-118</span></span><br><span class="line"><span class="type">key</span><span class="number">-113</span></span><br><span class="line"><span class="type">key</span><span class="number">-115</span></span><br><span class="line"><span class="type">key</span><span class="number">-112</span></span><br><span class="line"><span class="type">key</span><span class="number">-119</span></span><br><span class="line"><span class="type">key</span><span class="number">-11</span></span><br><span class="line"><span class="type">key</span><span class="number">-111</span></span><br><span class="line"><span class="type">key</span><span class="number">-110</span></span><br><span class="line"><span class="type">key</span><span class="number">-116</span></span><br></pre></td></tr></table></figure></p>
<p>Piping the output through the wc command can be used to count specific kind of objects, by key name:<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="string">redis-cli </span><span class="built_in">--scan</span> <span class="built_in">--pattern</span> <span class="string">&#x27;user:*&#x27;</span> | <span class="string">wc </span>-l</span><br><span class="line"><span class="string">3829433</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Pub-sub-mode"><a href="#Pub-sub-mode" class="headerlink" title="Pub/sub mode"></a>Pub/sub mode</h2><p>The CLI is able to publish messages in Redis Pub/Sub channels just using the <a target="_blank" rel="noopener" href="https://redis.io/commands/publish">PUBLISH</a> command. This is expected since the <a target="_blank" rel="noopener" href="https://redis.io/commands/publish">PUBLISH</a> command is very similar to any other command. Subscribing to channels in order to receive messages is different - in this case we need to block and wait for messages, so this is implemented as a special mode in redis-cli. Unlike other special modes this mode is not enabled by using a special option, but simply by using the <a target="_blank" rel="noopener" href="https://redis.io/commands/subscribe">SUBSCRIBE</a> or <a target="_blank" rel="noopener" href="https://redis.io/commands/psubscribe">PSUBSCRIBE</a> command, both in interactive or non interactive mode:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -p <span class="number">6381</span> psubscribe &#x27;*&#x27;</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;psubscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) (<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26381,3ad32fcf6646f1e65f75f1309fe858a66237a590,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26379,6db624d52ea9a46b76c996532de0d3b874011aef,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26380,55b2bbd5f4ca70d5bbb8fb019b645eaf39fb5e66,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26381,3ad32fcf6646f1e65f75f1309fe858a66237a590,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26379,6db624d52ea9a46b76c996532de0d3b874011aef,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;pmessage&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;__sentinel__:hello&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;127.0.0.1,26380,55b2bbd5f4ca70d5bbb8fb019b645eaf39fb5e66,3,mymaster,127.0.0.1,6381,3&quot;</span></span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<p>This is very useful for debugging Pub/Sub issues. To exit the Pub/Sub mode just process CTRL-C.</p>
<h2 id="Monitoring-commands-executed-in-Redis"><a href="#Monitoring-commands-executed-in-Redis" class="headerlink" title="Monitoring commands executed in Redis"></a>Monitoring commands executed in Redis</h2><p>Similarly to the Pub/Sub mode, the monitoring mode is entered automatically once you use the <a target="_blank" rel="noopener" href="https://redis.io/commands/monitor">MONITOR</a> mode. It will print all the commands received by a Redis instance:<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli monitor</span><br><span class="line">OK</span><br><span class="line"><span class="number">1460100081.165665</span> [<span class="number">0</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">51706</span>] <span class="string">&quot;set&quot;</span> <span class="string">&quot;foo&quot;</span> <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">1460100083.053365</span> [<span class="number">0</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">51707</span>] <span class="string">&quot;get&quot;</span> <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Monitoring-the-latency-of-Redis-instances"><a href="#Monitoring-the-latency-of-Redis-instances" class="headerlink" title="Monitoring the latency of Redis instances"></a>Monitoring the latency of Redis instances</h2><p>Redis经常用在延迟非常关键的环境中。 延迟涉及应用程序中的多个移动部分，从客户端库到网络堆栈，直到Redis实例本身。</p>
<p>CLI具有多个工具来研究Redis实例的延迟，并了解延迟的最大值，平均值和分布。</p>
<p>基本的延迟检查工具是–latency选项。 使用此选项，CLI运行一个循环，将PING命令发送到Redis实例，并测量获得答复的时间。 这种情况每秒发生100次，统计信息在控制台中实时更新：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">redis-cli</span> <span class="string">--latency</span></span><br><span class="line"><span class="attr">min:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">max:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">avg:</span> <span class="number">0.19</span> <span class="string">(427</span> <span class="string">samples)</span></span><br></pre></td></tr></table></figure></p>
<p>统计数据以毫秒提供。 通常，由于运行redis-cli本身的系统的内核调度程序导致延迟，所以一个非常快的实例的平均延迟往往被高估了一点，所以0.19以上的平均延迟可能很容易为0.01或更小。 然而，这通常不是一个大问题，因为我们对几毫秒甚至更长时间的事件感兴趣。</p>
<p>有时研究最大和平均潜伏期如何演变是有用的。 <code>--latency-history</code>选项用于此目的：它的工作方式与–latency完全相同，但是每15秒（默认情况下）将从头开始一个新的采样会话：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">redis-cli</span> <span class="string">--latency-history</span></span><br><span class="line"><span class="attr">min:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">max:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">avg:</span> <span class="number">0.14</span> <span class="string">(1314</span> <span class="string">samples)</span> <span class="string">--</span> <span class="number">15.01</span> <span class="string">seconds</span> <span class="string">range</span></span><br><span class="line"><span class="attr">min:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">max:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">avg:</span> <span class="number">0.18</span> <span class="string">(1299</span> <span class="string">samples)</span> <span class="string">--</span> <span class="number">15.00</span> <span class="string">seconds</span> <span class="string">range</span></span><br><span class="line"><span class="attr">min:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">max:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">avg:</span> <span class="number">0.20</span> <span class="string">(113</span> <span class="string">samples)^C</span></span><br></pre></td></tr></table></figure></p>
<p>您可以使用<code>-i &lt;间隔&gt;</code>选项更改采样会话的长度。</p>
<p>最先进的等待时间研究工具，对于没有经验的用户来说也有点难解释，是使用彩色终端显示一系列等待时间的能力。 您会看到一个彩色输出，指示不同百分比的样本，以及指示不同延迟数字的不同ASCII字符。 该模式使用–latency-dist选项启用：</p>
<p>在redis-cli中还有一个非常不寻常的延迟工具。 它不会检查Redis实例的延迟，而是检查运行redis-cli的计算机的延迟。 你可能会问什么延迟？ 内核调度程序固有的延迟，虚拟化实例情况下的管理程序等等。</p>
<p>我们称之为内部延迟，因为大多数程序员对它是不透明的。 如果您的Redis实例的延迟时间很长，而不考虑所有可能的原因，那么通过在运行Redis服务器的系统中直接运行此特殊模式下的redis-cli，可以检查系统的最佳性能。</p>
<p>通过测量内在的延迟，你知道这是基准，Redis不能超越你的系统。 为了在此模式下运行CLI，请使用<code>--intrinsic-latency &lt;test-time&gt;</code>。 测试的时间以秒为单位，并指定redis-cli应该检查当前正在运行的系统的延迟时间。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">redis-cli</span> <span class="string">--intrinsic-latency</span> <span class="number">5</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">1</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">7</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">9</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">11</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">13</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">15</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">34</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">82</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">586</span> <span class="string">microseconds.</span></span><br><span class="line"><span class="attr">Max latency so far:</span> <span class="number">739</span> <span class="string">microseconds.</span></span><br><span class="line"></span><br><span class="line"><span class="number">65433042</span> <span class="string">total</span> <span class="string">runs</span> <span class="string">(avg</span> <span class="attr">latency:</span> <span class="number">0.0764</span> <span class="string">microseconds</span> <span class="string">/</span> <span class="number">764.14</span> <span class="string">nanoseconds</span> <span class="string">per</span> <span class="string">run).</span></span><br><span class="line"><span class="string">Worst</span> <span class="string">run</span> <span class="string">took</span> <span class="string">9671x</span> <span class="string">longer</span> <span class="string">than</span> <span class="string">the</span> <span class="string">average</span> <span class="string">latency.</span></span><br></pre></td></tr></table></figure></p>
<p>重要信息：必须在要运行Redis服务器的计算机上执行此命令，而不是在不同的主机上运行。 它甚至不连接到Redis实例，只在本地执行测试。</p>
<p>在上述情况下，我的系统不能比739微秒的最坏情况延迟更好，所以我预计某些查询可能会在不到1毫秒的时间内运行。</p>
<h2 id="Remote-backups-of-RDB-files"><a href="#Remote-backups-of-RDB-files" class="headerlink" title="Remote backups of RDB files"></a>Remote backups of RDB files</h2><p>在Redis复制的第一次同步期间，主设备和从设备以RDB文件的形式交换整个数据集。 redis-cli利用此功能来提供远程备份功能，允许从任何Redis实例将RDB文件传输到运行redis-cli的本地计算机。 要使用此模式，请使用<code>--rdb &lt;dest-filename&gt;</code>选项调用CLI：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli <span class="comment">--rdb /tmp/dump.rdb</span></span><br><span class="line">SYNC sent <span class="built_in">to</span> master, writing <span class="number">13256</span> <span class="keyword">bytes</span> <span class="built_in">to</span> <span class="string">&#x27;/tmp/dump.rdb&#x27;</span></span><br><span class="line">Transfer finished <span class="keyword">with</span> success.</span><br></pre></td></tr></table></figure><br>这是确保您拥有Redis实例的灾难恢复RDB备份的简单而有效的方法。 但是，在脚本或cron作业中使用此选项时，请确保检查命令的返回值。 如果不为零，则发生如下例所示的错误：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli --rdb /tmp/dump.rdb</span><br><span class="line">SYNC with <span class="keyword">master</span> <span class="title">failed</span>: -ERR Can&#x27;t SYNC while not connected with my <span class="literal">master</span></span><br><span class="line">$ echo $?</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Slave-mode"><a href="#Slave-mode" class="headerlink" title="Slave mode"></a>Slave mode</h2><p>CLI的slave模式是用于Redis开发人员和调试操作的高级功能</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">这边跑着,同时主库执行<span class="builtin-name">set</span> foo bar</span><br><span class="line">$ redis-cli --slave</span><br><span class="line">SYNC with master, discarding 13256 bytes of bulk transfer<span class="built_in">..</span>.</span><br><span class="line">SYNC done.<span class="built_in"> Logging </span>commands <span class="keyword">from</span> master.</span><br><span class="line"><span class="string">&quot;PING&quot;</span></span><br><span class="line"><span class="string">&quot;SELECT&quot;</span>,<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="string">&quot;set&quot;</span>,<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="string">&quot;PING&quot;</span></span><br><span class="line"><span class="string">&quot;incr&quot;</span>,<span class="string">&quot;mycounter&quot;</span></span><br></pre></td></tr></table></figure>
<p>该命令首先丢弃第一个同步的RDB文件，然后以CSV格式记录每个收到的命令。</p>
<p>如果您认为某些命令在您的从站中没有被正确复制，那么这是检查发生了什么的好方法，也是有用的信息，以便改进错误报告。</p>
<h2 id="Performing-an-LRU-simulation"><a href="#Performing-an-LRU-simulation" class="headerlink" title="Performing an LRU simulation"></a>Performing an LRU simulation</h2><p>Redis通常用作LRU驱逐的缓存。根据keys的数量和为缓存分配的内存量（通过maxmemory指令指定），缓存命中和未命中的数量将会改变。有时，模拟命中率对正确设置缓存非常有用。</p>
<p>CLI有一个特殊的模式，它执行GET和SET操作的模拟，在请求模式中使用80-20％的幂律分布。这意味着20％的keys将被请求80％的时间，这是缓存场景中的普遍分布。</p>
<p>从理论上讲，考虑到请求分布和Redis内存开销，应该可以用数学公式分析计算命中率。但是，Redis可以配置不同的LRU设置（样本数量），LRU的实现（在Redis中近似）在不同版本之间会发生很大的变化。类似的，每个内存的数量可能会在不同的版本之间改变。这就是为什么这个工具是建立起来的：它的主要动机是测试Redis的LRU实现的质量，但是现在也可以用来测试一个给定的版本如何与你想要部署的想法一致。</p>
<p>为了使用这种模式，你需要在测试中指定keys的数量。您还需要配置一个有意义的maxmemory设置作为第一次尝试。</p>
<p>重要注意事项：在Redis配置中配置maxmemory设置是至关重要的：如果最大内存使用量没有上限，则最终命中率将为100％，因为所有的keys都可以存储在内存中。或者如果你指定了太多的keys并且没有最大的内存，最终所有的计算机RAM都将被使用。还需要配置一个适当的maxmemory策略，大多数时候你想要的是allkeys-lru。</p>
<p>在下面的例子中，我配置了一个100MB的内存限制和一个1000万keys的LRU模拟。</p>
<p>警告：测试使用流水线并将压力服务器，不要与生产实例一起使用。<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./redis-cli --lru-test <span class="number">10000000</span></span><br><span class="line"><span class="number">156000</span> Gets/sec | Hits: <span class="number">4552</span> (<span class="number">2.92</span>%) | Misses: <span class="number">151448</span> (<span class="number">97.08</span>%)</span><br><span class="line"><span class="number">153750</span> Gets/sec | Hits: <span class="number">12906</span> (<span class="number">8.39</span>%) | Misses: <span class="number">140844</span> (<span class="number">91.61</span>%)</span><br><span class="line"><span class="number">159250</span> Gets/sec | Hits: <span class="number">21811</span> (<span class="number">13.70</span>%) | Misses: <span class="number">137439</span> (<span class="number">86.30</span>%)</span><br><span class="line"><span class="number">151000</span> Gets/sec | Hits: <span class="number">27615</span> (<span class="number">18.29</span>%) | Misses: <span class="number">123385</span> (<span class="number">81.71</span>%)</span><br><span class="line"><span class="number">145000</span> Gets/sec | Hits: <span class="number">32791</span> (<span class="number">22.61</span>%) | Misses: <span class="number">112209</span> (<span class="number">77.39</span>%)</span><br><span class="line"><span class="number">157750</span> Gets/sec | Hits: <span class="number">42178</span> (<span class="number">26.74</span>%) | Misses: <span class="number">115572</span> (<span class="number">73.26</span>%)</span><br><span class="line"><span class="number">154500</span> Gets/sec | Hits: <span class="number">47418</span> (<span class="number">30.69</span>%) | Misses: <span class="number">107082</span> (<span class="number">69.31</span>%)</span><br><span class="line"><span class="number">151250</span> Gets/sec | Hits: <span class="number">51636</span> (<span class="number">34.14</span>%) | Misses: <span class="number">99614</span> (<span class="number">65.86</span>%)</span><br></pre></td></tr></table></figure><br>该程序每秒显示统计信息。 如您所见，在第一秒钟内缓存开始被填充。 后来的失误率稳定在我们可以预期的实际数字上：<br><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">120750 </span>Gets/sec | Hits: <span class="number">48774</span> (<span class="number">40.39</span>%) | Misses: <span class="number">71976</span> (<span class="number">59.61</span>%)</span><br><span class="line"><span class="symbol">122500 </span>Gets/sec | Hits: <span class="number">49052</span> (<span class="number">40.04</span>%) | Misses: <span class="number">73448</span> (<span class="number">59.96</span>%)</span><br><span class="line"><span class="symbol">127000 </span>Gets/sec | Hits: <span class="number">50870</span> (<span class="number">40.06</span>%) | Misses: <span class="number">76130</span> (<span class="number">59.94</span>%)</span><br><span class="line"><span class="symbol">124250 </span>Gets/sec | Hits: <span class="number">50147</span> (<span class="number">40.36</span>%) | Misses: <span class="number">74103</span> (<span class="number">59.64</span>%)</span><br></pre></td></tr></table></figure><br>对于我们的用例，59％的未命中率可能是不可接受的。 所以我们知道100MB的内存是不够的。 让我们试试500M。 几分钟后，我们将看到输出稳定到以下数字：<br><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">140000 </span>Gets/sec | Hits: <span class="number">135376</span> (<span class="number">96.70</span>%) | Misses: <span class="number">4624</span> (<span class="number">3.30</span>%)</span><br><span class="line"><span class="symbol">141250 </span>Gets/sec | Hits: <span class="number">136523</span> (<span class="number">96.65</span>%) | Misses: <span class="number">4727</span> (<span class="number">3.35</span>%)</span><br><span class="line"><span class="symbol">140250 </span>Gets/sec | Hits: <span class="number">135457</span> (<span class="number">96.58</span>%) | Misses: <span class="number">4793</span> (<span class="number">3.42</span>%)</span><br><span class="line"><span class="symbol">140500 </span>Gets/sec | Hits: <span class="number">135947</span> (<span class="number">96.76</span>%) | Misses: <span class="number">4553</span> (<span class="number">3.24</span>%)</span><br></pre></td></tr></table></figure><br>所以我们知道，在500MB的情况下，我们的密钥数量（1000万）和分布（80-20样式）已经足够好了。</p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>


<script src="/js/vdonate.js"></script>

<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/css/images/WechatIMG65.jpeg',
  alipayImage: 'https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/css/images/WechatIMG64.jpeg'
});
</script>
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>大范</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2018/01/18/redis-cli/" target="_blank" title="redis-cli,Redis命令行界面">http://fuxkdb.com/2018/01/18/redis-cli/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>

      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis-cli/" rel="tag">redis-cli</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/01/19/CONFIG%20REWRITE%E5%91%BD%E4%BB%A4/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2017/12/28/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E6%94%B9%E8%A1%A8%E5%85%B3%E8%81%94%E4%BC%98%E5%8C%96%E4%B8%80%E4%BE%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">自定义函数改表关联优化一例</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#redis-cli-Redis%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2"><span class="nav-number">1.</span> <span class="nav-text">redis-cli,Redis命令行界面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%94%A8%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">命令行用法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Host-port-password-and-database"><span class="nav-number">2.1.</span> <span class="nav-text">Host, port, password and database</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-input-from-other-programs"><span class="nav-number">2.2.</span> <span class="nav-text">Getting input from other programs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%81%E7%BB%AD%E8%BF%90%E8%A1%8C%E7%9B%B8%E5%90%8C%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">持续运行相同的命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8redis-cli%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">2.4.</span> <span class="nav-text">使用redis-cli批量插入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSV%E6%A0%BC%E5%BC%8F%E8%BE%93%E5%87%BA"><span class="nav-number">2.5.</span> <span class="nav-text">CSV格式输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8Clua%E8%84%9A%E6%9C%AC"><span class="nav-number">2.6.</span> <span class="nav-text">执行lua脚本</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Interactive-mode-%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">Interactive mode 交互模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%BF%9E%E6%8E%A5%E5%92%8C%E9%87%8D%E6%96%B0%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.1.</span> <span class="nav-text">处理连接和重新连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Editing-history-and-completion"><span class="nav-number">3.2.</span> <span class="nav-text">Editing, history and completion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-the-same-command-N-times"><span class="nav-number">3.3.</span> <span class="nav-text">Running the same command N times</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Showing-help-about-Redis-commands"><span class="nav-number">3.4.</span> <span class="nav-text">Showing help about Redis commands</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Clearing-the-terminal-screen-%E6%B8%85%E5%B1%8F"><span class="nav-number">3.5.</span> <span class="nav-text">Clearing the terminal screen 清屏</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">特殊的操作模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Continuous-stats-mode"><span class="nav-number">4.1.</span> <span class="nav-text">Continuous stats mode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scanning-for-big-keys"><span class="nav-number">4.2.</span> <span class="nav-text">Scanning for big keys</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-a-list-of-keys"><span class="nav-number">4.3.</span> <span class="nav-text">Getting a list of keys</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pub-sub-mode"><span class="nav-number">4.4.</span> <span class="nav-text">Pub&#x2F;sub mode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-commands-executed-in-Redis"><span class="nav-number">4.5.</span> <span class="nav-text">Monitoring commands executed in Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-the-latency-of-Redis-instances"><span class="nav-number">4.6.</span> <span class="nav-text">Monitoring the latency of Redis instances</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Remote-backups-of-RDB-files"><span class="nav-number">4.7.</span> <span class="nav-text">Remote backups of RDB files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Slave-mode"><span class="nav-number">4.8.</span> <span class="nav-text">Slave mode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performing-an-LRU-simulation"><span class="nav-number">4.9.</span> <span class="nav-text">Performing an LRU simulation</span></a></li></ol></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2022 Fan() All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>





  
<script src="/js/dialog.js"></script>









	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Fan()
          </div>
          <div class="panel-body">
            Copyright © 2022 大范 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>