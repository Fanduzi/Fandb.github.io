<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>clickhouse多实例部署 | Fan()</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="ClickHouse" />
  
  
  
  
  <meta name="description" content="ClickHouse多实例部署本人刚接触ClickHouse两周, 难免有错误之处, 感谢指正. 另外一些参数我也不甚理解, 大家也可以先不必纠结参数, 先部署起来再说, 我的感触是部署后就会对整体结构有了一遍认识. 如果多实例都可以部署完毕, 那么生产单实例部署当然就不成问题了. 生产环境并不建议多实例部署, ClickHouse一个查询可以用到多个CPU, 本例只适用于测试环境">
<meta property="og:type" content="article">
<meta property="og:title" content="ClickHouse多实例部署">
<meta property="og:url" content="http://fuxkdb.com/2020/05/02/2020-05-02-ClickHouse%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="Fan()">
<meta property="og:description" content="ClickHouse多实例部署本人刚接触ClickHouse两周, 难免有错误之处, 感谢指正. 另外一些参数我也不甚理解, 大家也可以先不必纠结参数, 先部署起来再说, 我的感触是部署后就会对整体结构有了一遍认识. 如果多实例都可以部署完毕, 那么生产单实例部署当然就不成问题了. 生产环境并不建议多实例部署, ClickHouse一个查询可以用到多个CPU, 本例只适用于测试环境">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/WX20200503-000148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/image-20200502202000580.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/image-20200502204517718.png">
<meta property="article:published_time" content="2020-05-02T15:46:00.000Z">
<meta property="article:modified_time" content="2020-09-22T02:35:42.616Z">
<meta property="article:author" content="大范">
<meta property="article:tag" content="ClickHouse">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/WX20200503-000148.png">
  
    <link rel="alternate" href="/atom.xml" title="Fan()" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpeg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpeg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    
<link rel="stylesheet" href="/css/dialog.css">

  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 6.2.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpeg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2020-05-02-ClickHouse多实例部署" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ClickHouse多实例部署
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2020/05/02/2020-05-02-ClickHouse%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/" class="article-date">
	  <time datetime="2020-05-02T15:46:00.000Z" itemprop="datePublished">2020-05-02</time>
	</a>

      
      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ClickHouse多实例部署"><a href="#ClickHouse多实例部署" class="headerlink" title="ClickHouse多实例部署"></a>ClickHouse多实例部署</h1><p>本人刚接触ClickHouse两周, 难免有错误之处, 感谢指正. 另外一些参数我也不甚理解, 大家也可以先不必纠结参数, 先部署起来再说, 我的感触是部署后就会对整体结构有了一遍认识. 如果多实例都可以部署完毕, 那么生产单实例部署当然就不成问题了.</p>
<p>生产环境并不建议多实例部署, ClickHouse一个查询可以用到多个CPU, 本例只适用于测试环境</p>
<a id="more"></a>
<h2 id="部署规划"><a href="#部署规划" class="headerlink" title="部署规划"></a>部署规划</h2><p><img src="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/WX20200503-000148.png" alt="WX20200503-000148"></p>
<p>集群部署关系如下:</p>
<p><img src="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/image-20200502202000580.png" alt="image-20200502202000580"></p>
<p>逻辑结构图如下:</p>
<p><img src="https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/images/clickhouse/multi_instance_deploy/image-20200502204517718.png" alt="image-20200502204517718"></p>
<p>编辑三台主机<code>/etc/hosts</code>添加如下内容:</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.16.120.10</span> centos-<span class="number">1</span></span><br><span class="line"><span class="number">172.16.120.11</span> centos-<span class="number">2</span></span><br><span class="line"><span class="number">172.16.120.12</span> centos-<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h2 id="依赖组件安装"><a href="#依赖组件安装" class="headerlink" title="依赖组件安装"></a>依赖组件安装</h2><h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><h4 id="下载openjdk"><a href="#下载openjdk" class="headerlink" title="下载openjdk"></a>下载openjdk</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://github.com/AdoptOpenJDK/openjdk<span class="number">8</span>-binaries/releases/download/jdk<span class="number">8</span>u<span class="number">242</span>-b<span class="number">08</span>/OpenJDK<span class="number">8</span>U-jdk_x<span class="number">64</span>_linux_hotspot_<span class="number">8</span>u<span class="number">242</span>b<span class="number">08</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> -zxvf OpenJDK<span class="number">8</span>U-jdk_x<span class="number">64</span>_linux_hotspot_<span class="number">8</span>u<span class="number">242</span>b<span class="number">08</span>.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>
<h4 id="做软链"><a href="#做软链" class="headerlink" title="做软链"></a>做软链</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/jdk8u242-b08 /u</span>sr<span class="regexp">/local/</span>java</span><br></pre></td></tr></table></figure>
<h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vi ~/.bashrc</span></span><br><span class="line"> </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/local/java</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure>
<h3 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h3><p>3.6.0有bug</p>
<p>所以改用稳定版本3.4.14</p>
<h4 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://downloads.apache.org/zookeeper/zookeeper-<span class="number">3</span>.<span class="number">4</span>.<span class="number">14</span>/zookeeper-<span class="number">3</span>.<span class="number">4</span>.<span class="number">14</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> -zxvf zookeeper-<span class="number">3</span>.<span class="number">4</span>.<span class="number">14</span>.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>
<h4 id="做软链-1"><a href="#做软链-1" class="headerlink" title="做软链"></a>做软链</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/zookeeper-3.4.14 /u</span>sr<span class="regexp">/local/</span>zookeeper</span><br></pre></td></tr></table></figure>
<h4 id="配置环境变量-1"><a href="#配置环境变量-1" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vi ~/.bashrc</span></span><br><span class="line"> </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ZOOKEEPER_HOME</span>=/usr/local/zookeeper</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$ZOOKEEPER_HOME/bin</span><br></pre></td></tr></table></figure>
<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/zookeeper/conf</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#参考官方</span><br><span class="line">#https:<span class="comment">//clickhouse.tech/docs/en/operations/tips/#zookeeper</span></span><br><span class="line">#vim zoo.cfg</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">tickTime=<span class="number">2000</span></span><br><span class="line">initLimit=<span class="number">30000</span></span><br><span class="line">syncLimit=<span class="number">10</span></span><br><span class="line">maxClientCnxns=<span class="number">2000</span></span><br><span class="line">maxSessionTimeout=<span class="number">60000000</span></span><br><span class="line">dataDir=/data/zookeeper/data</span><br><span class="line">dataLogDir=/data/zookeeper/logs</span><br><span class="line"><span class="built_in">auto</span>purge.snapRetainCount=<span class="number">10</span></span><br><span class="line"><span class="built_in">auto</span>purge.purgeInterval=<span class="number">1</span></span><br><span class="line">preAllocSize=<span class="number">131072</span></span><br><span class="line">snapCount=<span class="number">3000000</span></span><br><span class="line">leaderServes=yes</span><br><span class="line">clientPort=<span class="number">2181</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">集群配置部分三个节点分别为:</span><br><span class="line"># centos<span class="number">-1</span></span><br><span class="line">server<span class="number">.1</span>=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.2</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.11</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.3</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.12</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"># centos<span class="number">-2</span></span><br><span class="line">server<span class="number">.1</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.10</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.2</span>=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.3</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.12</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"># centos<span class="number">-3</span></span><br><span class="line">server<span class="number">.1</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.10</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.2</span>=<span class="number">172.16</span><span class="number">.120</span><span class="number">.11</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server<span class="number">.3</span>=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br></pre></td></tr></table></figure>
<h4 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/data/</span>zookeeper/&#123;data,logs&#125;</span><br><span class="line">mkdir -p <span class="regexp">/usr/</span>local<span class="regexp">/zookeeper/</span>logs</span><br></pre></td></tr></table></figure>
<h4 id="myid"><a href="#myid" class="headerlink" title="myid"></a>myid</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos-1</span></span><br><span class="line">echo <span class="string">&quot;1&quot;</span>&gt;<span class="regexp">/data/</span>zookeeper<span class="regexp">/data/myi</span>d</span><br><span class="line">  </span><br><span class="line"><span class="comment"># centos-2</span></span><br><span class="line">echo <span class="string">&quot;2&quot;</span>&gt;<span class="regexp">/data/</span>zookeeper<span class="regexp">/data/myi</span>d</span><br><span class="line">  </span><br><span class="line"><span class="comment"># centos-3</span></span><br><span class="line">echo <span class="string">&quot;3&quot;</span>&gt;<span class="regexp">/data/</span>zookeeper<span class="regexp">/data/myi</span>d</span><br></pre></td></tr></table></figure>
<h4 id="配置zk日志"><a href="#配置zk日志" class="headerlink" title="配置zk日志"></a>配置zk日志</h4><p>默认zk日志输出到一个文件,且不会自动清理,所以,一段时间后zk日志会非常大</p>
<h5 id="1-zookeeper-env-sh-conf目录下新建zookeeper-env-sh文件-修改到sudo-chmod-755-zookeeper-env-sh权限"><a href="#1-zookeeper-env-sh-conf目录下新建zookeeper-env-sh文件-修改到sudo-chmod-755-zookeeper-env-sh权限" class="headerlink" title="1.zookeeper-env.sh  ./conf目录下新建zookeeper-env.sh文件,修改到sudo chmod 755 zookeeper-env.sh权限"></a><code>1.zookeeper-env.sh</code>  <code>./conf</code>目录下新建<code>zookeeper-env.sh</code>文件,修改到<code>sudo chmod 755 zookeeper-env.sh</code>权限</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cat conf/zookeeper-env.sh</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment">#tip:custom configurationfile，do not amend the zkEnv.sh file</span></span><br><span class="line"><span class="comment">#chang the log dir and output of rolling file</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">ZOO_LOG_DIR</span>=<span class="string">&quot;/usr/local/zookeeper/logs&quot;</span></span><br><span class="line"><span class="attr">ZOO_LOG4J_PROP</span>=<span class="string">&quot;INFO,ROLLINGFILE&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-log4j-properties-修改日志的输入形式"><a href="#2-log4j-properties-修改日志的输入形式" class="headerlink" title="2.log4j.properties 修改日志的输入形式"></a>2.log4j.properties 修改日志的输入形式</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zookeeper.root.logger</span>=INFO, ROLLINGFILE</span><br><span class="line"><span class="comment">#zookeeper.root.logger=INFO, CONSOLE</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Max log file size of 10MB</span></span><br><span class="line"><span class="attr">log4j.appender.ROLLINGFILE.MaxFileSize</span>=<span class="number">128</span>MB</span><br><span class="line"><span class="comment"># uncomment the next line to limit number of backup files</span></span><br><span class="line"><span class="attr">log4j.appender.ROLLINGFILE.MaxBackupIndex</span>=<span class="number">10</span></span><br></pre></td></tr></table></figure>
<h4 id="配置运行zk的JVM"><a href="#配置运行zk的JVM" class="headerlink" title="配置运行zk的JVM"></a>配置运行zk的JVM</h4><p><code>./conf</code>目录下新建<code>java.env</code>文件,修改到<code>sudo chmod 755 java.env</code>权限,主要用于<code>GC log</code>,<code>RAM</code>等的配置.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment">#config the jvm parameter in a reasonable</span></span><br><span class="line"><span class="comment">#note that the shell is source in so that do not need to use export</span></span><br><span class="line"><span class="comment">#set java  classpath</span></span><br><span class="line"><span class="comment">#CLASSPATH=&quot;&quot;</span></span><br><span class="line"><span class="comment">#set jvm start parameter , also can set JVMFLAGS variable</span></span><br><span class="line">SERVER_JVMFLAGS=<span class="string">&quot;-Xms1024m -Xmx2048m <span class="variable">$JVMFLAGS</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="启动zookeeper服务-所有节点"><a href="#启动zookeeper服务-所有节点" class="headerlink" title="启动zookeeper服务(所有节点)"></a>启动zookeeper服务(所有节点)</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zkServer.sh start</span></span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/zookeeper/bin/<span class="built_in">..</span>/conf/zoo.cfg</span><br><span class="line">Starting zookeeper <span class="built_in">..</span>. STARTED</span><br></pre></td></tr></table></figure>
<h4 id="验证zk"><a href="#验证zk" class="headerlink" title="验证zk"></a>验证zk</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># zkServer.sh status</span><br><span class="line"> </span><br><span class="line">#bin/zkCli.sh -server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span></span><br><span class="line">Connecting to <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">0</span>]</span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">0</span>] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">1</span>] create /zk_test mydata</span><br><span class="line">Created /zk_test</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">2</span>] ls /</span><br><span class="line">[zk_test, zookeeper]</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">3</span>] <span class="keyword">get</span> /zk_test</span><br><span class="line">mydata</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">4</span>] <span class="keyword">set</span> /zk_test junk</span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">5</span>] <span class="keyword">get</span> /zk_test</span><br><span class="line">junk</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">6</span>] delete /zk_test</span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">7</span>] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line"> </span><br><span class="line">[zk: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span>(CONNECTED) <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<h1 id="ClickHouse安装"><a href="#ClickHouse安装" class="headerlink" title="ClickHouse安装"></a>ClickHouse安装</h1><h2 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line">rpm --import https:<span class="regexp">//</span>repo.clickhouse.tech/CLICKHOUSE-KEY.GPG</span><br><span class="line">yum-config-manager --add-repo https:<span class="regexp">//</span>repo.clickhouse.tech<span class="regexp">/rpm/</span>stable/x86_64</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">yum install clickhouse-server clickhouse-client</span><br></pre></td></tr></table></figure>
<h2 id="创建目录-1"><a href="#创建目录-1" class="headerlink" title="创建目录"></a>创建目录</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">centos-<span class="number">1</span> 创建目录：</span><br><span class="line">mkdir -p <span class="regexp">/data/</span>clickhouse<span class="regexp">/&#123;node1,node4&#125;/</span>&#123;data,tmp,logs&#125;</span><br><span class="line">  </span><br><span class="line">centos-<span class="number">2</span> 创建目录：</span><br><span class="line">mkdir -p <span class="regexp">/data/</span>clickhouse<span class="regexp">/&#123;node2,node5&#125;/</span>&#123;data,tmp,logs&#125;</span><br><span class="line">  </span><br><span class="line">centos-<span class="number">3</span> 创建目录：</span><br><span class="line">mkdir -p <span class="regexp">/data/</span>clickhouse<span class="regexp">/&#123;node3,node6&#125;/</span>&#123;data,tmp,logs&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>配置clickhouse参数文件，账户文件，分片配置文件</p>
<p>这部分会<code>啰嗦</code>一些, 节点间有一些重复的配置为了方便也没有省略, 都贴出来了, 照着配置就可以了</p>
<h3 id="node1配置文件如下"><a href="#node1配置文件如下" class="headerlink" title="node1配置文件如下"></a>node1配置文件如下</h3><h4 id="config-xml"><a href="#config-xml" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node1/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node1/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8123<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9009<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node1/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node1/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node1/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8001<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node1/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml"><a href="#users-xml" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml"><a href="#metrika-xml" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>01<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前节点IP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="node2配置文件如下"><a href="#node2配置文件如下" class="headerlink" title="node2配置文件如下:"></a>node2配置文件如下:</h3><h4 id="config-xml-1"><a href="#config-xml-1" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node2/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node2/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8123<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9009<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node2/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node2/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node2/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8001<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node2/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml-1"><a href="#users-xml-1" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml-1"><a href="#metrika-xml-1" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>02<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node2<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前节点IP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="node3配置文件如下"><a href="#node3配置文件如下" class="headerlink" title="node3配置文件如下:"></a>node3配置文件如下:</h3><h4 id="config-xml-2"><a href="#config-xml-2" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node3/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node3/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8123<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9009<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node3/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node3/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node3/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8001<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node3/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml-2"><a href="#users-xml-2" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml-2"><a href="#metrika-xml-2" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>03<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node3<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前节点IP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="node4配置文件如下"><a href="#node4配置文件如下" class="headerlink" title="node4配置文件如下:"></a>node4配置文件如下:</h3><h4 id="config-xml-3"><a href="#config-xml-3" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node4/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node4/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8124<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9010<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node4/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node4/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node4/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node4/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml-3"><a href="#users-xml-3" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml-3"><a href="#metrika-xml-3" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>02<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node4<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="node5配置文件如下"><a href="#node5配置文件如下" class="headerlink" title="node5配置文件如下:"></a>node5配置文件如下:</h3><h4 id="config-xml-4"><a href="#config-xml-4" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node5/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node5/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8124<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9010<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node5/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node5/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node5/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node5/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml-4"><a href="#users-xml-4" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml-4"><a href="#metrika-xml-4" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>03<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node5<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前节点IP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="node6配置文件如下"><a href="#node6配置文件如下" class="headerlink" title="node6配置文件如下:"></a>node6配置文件如下:</h3><h4 id="config-xml-5"><a href="#config-xml-5" class="headerlink" title="config.xml"></a>config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>warning<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log</span>&gt;</span>/data/clickhouse/node6/logs/clickhouse.log<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">errorlog</span>&gt;</span>/data/clickhouse/node6/logs/error.log<span class="tag">&lt;/<span class="name">errorlog</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span>500M<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">count</span>&gt;</span>5<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地节点信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http_port</span>&gt;</span>8124<span class="tag">&lt;/<span class="name">http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tcp_port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">tcp_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_port</span>&gt;</span>9010<span class="tag">&lt;/<span class="name">interserver_http_port</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interserver_http_host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">interserver_http_host</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本机域名或IP--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--本地配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_connections</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">max_connections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receive_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">receive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">send_timeout</span>&gt;</span>800<span class="tag">&lt;/<span class="name">send_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep_alive_timeout</span>&gt;</span>3<span class="tag">&lt;/<span class="name">keep_alive_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_concurrent_queries</span>&gt;</span>64<span class="tag">&lt;/<span class="name">max_concurrent_queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uncompressed_cache_size</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">uncompressed_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mark_cache_size</span>&gt;</span>5368709120<span class="tag">&lt;/<span class="name">mark_cache_size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/data/clickhouse/node6/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tmp_path</span>&gt;</span>/data/clickhouse/node6/tmp/<span class="tag">&lt;/<span class="name">tmp_path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users_config</span>&gt;</span>/data/clickhouse/node6/users.xml<span class="tag">&lt;/<span class="name">users_config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">database</span>&gt;</span>system<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span>query_thread_log<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">partition_by</span>&gt;</span>toMonday(event_date)<span class="tag">&lt;/<span class="name">partition_by</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flush_interval_milliseconds</span>&gt;</span>7500<span class="tag">&lt;/<span class="name">flush_interval_milliseconds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">query_thread_log</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prometheus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span>&gt;</span>/metrics<span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">metrics</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">events</span>&gt;</span>true<span class="tag">&lt;/<span class="name">events</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asynchronous_metrics</span>&gt;</span>true<span class="tag">&lt;/<span class="name">asynchronous_metrics</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prometheus</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_database</span>&gt;</span>default<span class="tag">&lt;/<span class="name">default_database</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>Asia/Shanghai<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--集群相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remote_servers</span> <span class="attr">incl</span>=<span class="string">&quot;clickhouse_remote_servers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper</span> <span class="attr">incl</span>=<span class="string">&quot;zookeeper-servers&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span> <span class="attr">incl</span>=<span class="string">&quot;macros&quot;</span> <span class="attr">optional</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_session_timeout</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default_session_timeout</span>&gt;</span>300<span class="tag">&lt;/<span class="name">default_session_timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_delay_insert</span>&gt;</span>300<span class="tag">&lt;/<span class="name">parts_to_delay_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parts_to_throw_insert</span>&gt;</span>600<span class="tag">&lt;/<span class="name">parts_to_throw_insert</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">max_delay_to_insert</span>&gt;</span>2<span class="tag">&lt;/<span class="name">max_delay_to_insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">merge_tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_table_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_table_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_partition_size_to_drop</span>&gt;</span>0<span class="tag">&lt;/<span class="name">max_partition_size_to_drop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributed_ddl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include_from</span>&gt;</span>/data/clickhouse/node6/metrika.xml<span class="tag">&lt;/<span class="name">include_from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="users-xml-5"><a href="#users-xml-5" class="headerlink" title="users.xml"></a>users.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 请根据自己机器实际内存配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>put_your_passwordsha256hex_here<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="metrika-xml-5"><a href="#metrika-xml-5" class="headerlink" title="metrika.xml"></a>metrika.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ck集群节点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集1--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集2--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分片3--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--复制集3--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9002<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">user</span>&gt;</span>default<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">password</span>&gt;</span>supersecrect<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_cluster_all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>centos-3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer</span>&gt;</span>01<span class="tag">&lt;/<span class="name">layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>01<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分片号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node6<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前节点IP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--压缩相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--压缩算法lz4压缩比zstd快, 更占磁盘--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="用户密码生成方式"><a href="#用户密码生成方式" class="headerlink" title="用户密码生成方式"></a>用户密码生成方式</h2><p>密码生成方式：</p>
<p><a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/operations/settings/settings_users/">https://clickhouse.tech/docs/en/operations/settings/settings_users/</a></p>
<p>shell命令行执行：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PASSWORD=<span class="constructor">$(<span class="params">base64</span> &lt; <span class="operator">/</span><span class="params">dev</span><span class="operator">/</span><span class="params">urandom</span> | <span class="params">head</span> -<span class="params">c8</span>)</span>; echo <span class="string">&quot;$PASSWORD&quot;</span>; echo -n <span class="string">&quot;$PASSWORD&quot;</span> <span class="pattern-match">| sha256sum | tr -d &#x27;-&#x27; </span></span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X1UNizCS（明文密码）</span><br><span class="line"><span class="number">379444</span>c5e109e2f7e5f284831db54cd955011e6ae27d6e7a572cca635fbc7b1d  （加密长密码, 即password_sha256_hex）</span><br></pre></td></tr></table></figure>
<h2 id="修改属主"><a href="#修改属主" class="headerlink" title="修改属主"></a>修改属主</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">cd</span> /<span class="class"><span class="keyword">data</span> &amp;&amp; chown -<span class="type">R</span>  clickhouse.clickhouse clickhouse</span></span><br></pre></td></tr></table></figure>
<h2 id="进程守护"><a href="#进程守护" class="headerlink" title="进程守护"></a>进程守护</h2><p>使用systemd管理</p>
<p>以node1为例</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/systemd/system/clickhouse_node1.service</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[Unit]</span><br><span class="line"><span class="attribute">Description</span>=ClickHouse<span class="built_in"> Server </span>(analytic DBMS <span class="keyword">for</span> big data)</span><br><span class="line"><span class="attribute">Requires</span>=network-online.target</span><br><span class="line"><span class="attribute">After</span>=network-online.target</span><br><span class="line"> </span><br><span class="line">[Service]</span><br><span class="line"><span class="comment">#Type=simple</span></span><br><span class="line"><span class="attribute">Type</span>=forking</span><br><span class="line"><span class="attribute">User</span>=clickhouse</span><br><span class="line"><span class="attribute">Group</span>=clickhouse</span><br><span class="line"><span class="attribute">Restart</span>=always</span><br><span class="line"><span class="attribute">RestartSec</span>=30</span><br><span class="line"><span class="attribute">RuntimeDirectory</span>=clickhouse-server</span><br><span class="line"><span class="comment">#ExecStart=/usr/bin/clickhouse-server --config=/etc/clickhouse-server/config.xml --pid-file=/run/clickhouse-server/clickhouse-server.pid</span></span><br><span class="line"><span class="attribute">ExecStart</span>=/usr/bin/clickhouse-server --daemon <span class="attribute">--config</span>=/data/clickhouse/ch_9000/config.xml <span class="attribute">--pid-file</span>=/data/clickhouse/node1/clickhouse-server.pid</span><br><span class="line"><span class="comment">#PIDFile=/data/clickhouse/node1/clickhouse-server.pid</span></span><br><span class="line"><span class="attribute">LimitCORE</span>=infinity</span><br><span class="line"><span class="attribute">LimitNOFILE</span>=500000</span><br><span class="line"><span class="attribute">CapabilityBoundingSet</span>=CAP_NET_ADMIN CAP_IPC_LOCK CAP_SYS_NICE</span><br><span class="line"> </span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>
<p>以上面的配置作为模板创建 node1~node6 的systemd配置文件</p>
<h2 id="ClickHouse服务启动"><a href="#ClickHouse服务启动" class="headerlink" title="ClickHouse服务启动"></a>ClickHouse服务启动</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">centos<span class="number">-1</span>主机进行如下操作：</span><br><span class="line">systemctl start clickhouse_node1.service</span><br><span class="line">systemctl start clickhouse_node4.service</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">centos<span class="number">-2</span>主机进行如下操作：</span><br><span class="line">systemctl start clickhouse_node2.service</span><br><span class="line">systemctl start clickhouse_node5.service</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">centos<span class="number">-3</span>主机进行如下操作：</span><br><span class="line">systemctl start clickhouse_node3.service</span><br><span class="line">systemctl start clickhouse_node6.service</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">验证如下端口是否被监听：</span><br><span class="line">netstat -anlp|grep <span class="number">9000</span> （clickhouse tcp端口）</span><br><span class="line">netstat -anlp|grep <span class="number">9002</span> （clickhouse tcp端口）</span><br><span class="line">netstat -anlp|grep <span class="number">8123</span>    (clickhouse http端口)</span><br><span class="line">netstat -anlp|grep <span class="number">8124</span>    (clickhouse http端口)</span><br><span class="line">netstat -anlp|grep <span class="number">9009</span>   (clickhouse 数据交互端口)</span><br><span class="line">netstat -anlp|grep <span class="number">9010</span>    (clickhouse 数据交互端口)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">登陆方式：</span><br><span class="line">clickhouse-client -u <span class="section">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-1</span> --query=<span class="string">&quot;show databases&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="测试集群功能是否正常"><a href="#测试集群功能是否正常" class="headerlink" title="测试集群功能是否正常"></a>测试集群功能是否正常</h2><h3 id="创建数据库testdb"><a href="#创建数据库testdb" class="headerlink" title="创建数据库testdb"></a>创建数据库testdb</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-1</span></span><br><span class="line">ClickHouse client version <span class="number">20.3</span><span class="number">.4</span><span class="number">.10</span> (official build).</span><br><span class="line">Connecting to localhost:<span class="number">9000</span> as user <span class="keyword">default</span>.</span><br><span class="line">Connected to ClickHouse server version <span class="number">20.3</span><span class="number">.4</span> revision <span class="number">54433.</span></span><br><span class="line"></span><br><span class="line">centos<span class="number">-1</span> :) create database testdb on cluster ch_cluster_all;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE testdb ON CLUSTER ck_cluster</span><br><span class="line"></span><br><span class="line">┌─host─────┬─port─┬─status─┬─error─┬─num_hosts_remaining─┬─num_hosts_active─┐</span><br><span class="line">│ centos<span class="number">-3</span> │ <span class="number">9000</span> │      <span class="number">0</span> │       │                   <span class="number">5</span> │                <span class="number">0</span> │</span><br><span class="line">│ centos<span class="number">-2</span> │ <span class="number">9000</span> │      <span class="number">0</span> │       │                   <span class="number">4</span> │                <span class="number">0</span> │</span><br><span class="line">│ centos<span class="number">-1</span> │ <span class="number">9002</span> │      <span class="number">0</span> │       │                   <span class="number">3</span> │                <span class="number">0</span> │</span><br><span class="line">│ centos<span class="number">-3</span> │ <span class="number">9002</span> │      <span class="number">0</span> │       │                   <span class="number">2</span> │                <span class="number">0</span> │</span><br><span class="line">│ centos<span class="number">-1</span> │ <span class="number">9000</span> │      <span class="number">0</span> │       │                   <span class="number">1</span> │                <span class="number">0</span> │</span><br><span class="line">│ centos<span class="number">-2</span> │ <span class="number">9002</span> │      <span class="number">0</span> │       │                   <span class="number">0</span> │                <span class="number">0</span> │</span><br><span class="line">└──────────┴──────┴────────┴───────┴─────────────────────┴──────────────────┘</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> rows <span class="keyword">in</span> <span class="keyword">set</span>. Elapsed: <span class="number">0.107</span> sec. </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="创建本地表"><a href="#创建本地表" class="headerlink" title="创建本地表"></a>创建本地表</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-1 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-01/sbtest&#x27;,&#x27;node1&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-1 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-02/sbtest&#x27;,&#x27;node4&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-2 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-02/sbtest&#x27;,&#x27;node2&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-2 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-03/sbtest&#x27;,&#x27;node5&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-3 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-03/sbtest&#x27;,&#x27;node3&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-3 <span class="attribute">--query</span>=<span class="string">&quot;CREATE TABLE testdb.sbtest_local</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = ReplicatedMergeTree(&#x27;/clickhouse/tables/01-01/sbtest&#x27;,&#x27;node6&#x27;)</span></span><br><span class="line"><span class="string">PARTITION BY toYYYYMM(EventDate)</span></span><br><span class="line"><span class="string">ORDER BY (CounterID, EventDate, intHash32(UserID))</span></span><br><span class="line"><span class="string">SETTINGS index_granularity = 8192;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建分布式表"><a href="#创建分布式表" class="headerlink" title="创建分布式表"></a>创建分布式表</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-1 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-1 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-2 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-2 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9000 -hcentos-3 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br><span class="line"></span><br><span class="line">clickhouse-client -u<span class="built_in"> default </span>--password xxxxxx --port 9002 -hcentos-3 <span class="attribute">--query</span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">CREATE TABLE testdb.sbtest (</span></span><br><span class="line"><span class="string">EventDate DateTime,</span></span><br><span class="line"><span class="string">CounterID UInt32,</span></span><br><span class="line"><span class="string">UserID UInt32</span></span><br><span class="line"><span class="string">) ENGINE = Distributed(ck_cluster,testdb, sbtest_local, rand())&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="验证数据复制状态："><a href="#验证数据复制状态：" class="headerlink" title="验证数据复制状态："></a>验证数据复制状态：</h3><h4 id="写入分片1组的写入节点的local表"><a href="#写入分片1组的写入节点的local表" class="headerlink" title="写入分片1组的写入节点的local表"></a>写入分片1组的写入节点的local表</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="section">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-1</span> --query=<span class="string">&quot;insert into testdb.sbtest_local VALUES (now(), 10000, 10000)&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片1组local表可见一条记录"><a href="#在分片1组local表可见一条记录" class="headerlink" title="在分片1组local表可见一条记录"></a>在分片1组local表可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-1</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">02</span>:<span class="number">31</span>     <span class="number">10000</span>   <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片1-副本节点local读取可见一条记录"><a href="#在分片1-副本节点local读取可见一条记录" class="headerlink" title="在分片1 副本节点local读取可见一条记录"></a>在分片1 副本节点local读取可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9002</span> -hcentos<span class="number">-3</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">02</span>:<span class="number">31</span>     <span class="number">10000</span>   <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<h4 id="写入分片2组的写入节点的local表"><a href="#写入分片2组的写入节点的local表" class="headerlink" title="写入分片2组的写入节点的local表"></a>写入分片2组的写入节点的local表</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="section">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-2</span> --query=<span class="string">&quot;insert into testdb.sbtest_local VALUES (now(), 20000, 20000)&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片2组local表可见一条记录"><a href="#在分片2组local表可见一条记录" class="headerlink" title="在分片2组local表可见一条记录"></a>在分片2组local表可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-2</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">03</span>:<span class="number">31</span>     <span class="number">20000</span>   <span class="number">20000</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片2-副本节点local读取可见一条记录"><a href="#在分片2-副本节点local读取可见一条记录" class="headerlink" title="在分片2 副本节点local读取可见一条记录"></a>在分片2 副本节点local读取可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9002</span> -hcentos<span class="number">-1</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">03</span>:<span class="number">31</span>     <span class="number">20000</span>   <span class="number">20000</span></span><br></pre></td></tr></table></figure>
<h4 id="写入分片3组的写入节点的local表"><a href="#写入分片3组的写入节点的local表" class="headerlink" title="写入分片3组的写入节点的local表"></a>写入分片3组的写入节点的local表</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="section">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-3</span> --query=<span class="string">&quot;insert into testdb.sbtest_local VALUES (now(), 30000, 30000)&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片3组local表可见一条记录"><a href="#在分片3组local表可见一条记录" class="headerlink" title="在分片3组local表可见一条记录"></a>在分片3组local表可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-3</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">04</span>:<span class="number">39</span>     <span class="number">30000</span>   <span class="number">30000</span></span><br></pre></td></tr></table></figure>
<h4 id="在分片3-副本节点local读取可见一条记录"><a href="#在分片3-副本节点local读取可见一条记录" class="headerlink" title="在分片3 副本节点local读取可见一条记录"></a>在分片3 副本节点local读取可见一条记录</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9002</span> -hcentos<span class="number">-2</span> --query=<span class="string">&quot;select * from testdb.sbtest_local&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">04</span>:<span class="number">39</span>     <span class="number">30000</span>   <span class="number">30000</span></span><br></pre></td></tr></table></figure>
<h4 id="Distributed表验证"><a href="#Distributed表验证" class="headerlink" title="Distributed表验证"></a>Distributed表验证</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># clickhouse-client -u <span class="keyword">default</span> --password xxxxxx --port <span class="number">9000</span> -hcentos<span class="number">-1</span> --query=<span class="string">&quot;select * from testdb.sbtest&quot;</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">02</span>:<span class="number">31</span>     <span class="number">10000</span>   <span class="number">10000</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">03</span>:<span class="number">31</span>     <span class="number">20000</span>   <span class="number">20000</span></span><br><span class="line"><span class="number">2020</span><span class="number">-05</span><span class="number">-02</span> <span class="number">23</span>:<span class="number">04</span>:<span class="number">39</span>     <span class="number">30000</span>   <span class="number">30000</span></span><br></pre></td></tr></table></figure>
<p>可以看到结果是之前写入的3条记录</p>
<p>结论，clickhouse基本功能正常</p>
<h3 id="macros建表"><a href="#macros建表" class="headerlink" title="macros建表"></a>macros建表</h3><p>集群后期规模较大，创建分布式表时很复杂，clickhouse提供了在配置文件定义macros，创建表使用<code>&#123;&#125;</code>替代具体参数的方式，让表创建更透明方便。</p>
<blockquote>
<p>可以在config.xml和metrika.xml中搜索一下macros找到相应的配置</p>
</blockquote>
<p>使用以下语句连接一个节点即可再集群所有节点创建好对应的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ReplicatedMergeTree表示例：</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> testdb.sbtest_local <span class="keyword">on</span> cluster ch_cluster_all</span><br><span class="line">(</span><br><span class="line">EventDate DateTime,</span><br><span class="line">CounterID UInt32,</span><br><span class="line">UserID UInt32</span><br><span class="line">) <span class="keyword">ENGINE</span> = ReplicatedMergeTree(<span class="string">&#x27;/clickhouse/tables/&#123;layer&#125;-&#123;shard&#125;/sbtest_local&#x27;</span>, <span class="string">&#x27;&#123;replica&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(EventDate)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (CounterID, EventDate, intHash32(UserID));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Distributed表示例：</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> testdb.sbtest <span class="keyword">ON</span> CLUSTER ch_cluster_all <span class="keyword">AS</span> testdb.sbtest_local <span class="keyword">engine</span> = <span class="keyword">Distributed</span>(ch_cluster_all, testdb, sbtest_local, <span class="keyword">rand</span>());</span><br></pre></td></tr></table></figure>
<h1 id="ClickHouse用户管理"><a href="#ClickHouse用户管理" class="headerlink" title="ClickHouse用户管理"></a>ClickHouse用户管理</h1><p>据我了解ClickHouse没有创建用户的语句(现在已经有了), 创建用户的方式是增加配置参数, ClickHouse会自动检测配置文件变化, 所以无需重启服务</p>
<p>在之前的配置中我们制定了如下配置</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;users_config&gt;<span class="regexp">/data/</span>clickhouse<span class="regexp">/node1/u</span>sers.xml&lt;/users_config&gt;</span><br></pre></td></tr></table></figure>
<p>这表示用户配置在这个文件下. 其实根据<a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/operations/configuration_files/">官方文档</a>介绍, 我们可以在<code>/data/clickhouse/node1</code>目录下创建<code>users.d</code>目录, 为每个用户创建单独的配置文件, 这样就不必在一个<code>users.xml</code>中维护所有用户信息了, ClickHouse会自动合并<code>/data/clickhouse/node1/users.xml</code>和<code>/data/clickhouse/node1/users.d/*.xml</code>, 生产一个”运行时”配置<code>/data/clickhouse/node1/preprocessed_configs/users.xml</code></p>
<p>例如我在<code>users.d</code>创建了两个用户</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-1 node1]# cd users.d/</span><br><span class="line">[root@centos-1 users.d]# ll</span><br><span class="line">total 12</span><br><span class="line">-rwxr-xr-x 1 clickhouse clickhouse 1025 Apr 29 17:46 fanboshi.xml</span><br><span class="line">-rwxr-xr-x 1 clickhouse clickhouse 1035 Apr 30 16:35 monitor_ro.xml</span><br><span class="line">[root@centos-1 users.d]# cat fanboshi.xml </span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>0<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>fanboshi_user_password_sha256_hex<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>fanboshi<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br><span class="line">[root@centos-1 users.d]# cat monitor_ro.xml </span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">monitor_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>0<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">monitor_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">monitor_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>monitor_ro_user_password_sha256_hex<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>monitor_ro<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">monitor_ro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>目前我个人建议将一个用户的profile, quota等信息都配置到一个配置文件中, 避免混乱</p>
<p>如此配置之后, <code>/data/clickhouse/node1/preprocessed_configs/users.xml</code>就会自动合并我们的所有用户配置, 生成如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- This file was generated automatically.</span></span><br><span class="line"><span class="comment">     Do not edit it: it is likely to be discarded and generated again before it&#x27;s read next time.</span></span><br><span class="line"><span class="comment">     Files used to generate this file:</span></span><br><span class="line"><span class="comment">       /data/clickhouse/node1/users.xml</span></span><br><span class="line"><span class="comment">       /data/clickhouse/node1/users.d/fanboshi.xml      --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每个 session 的内存限制 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>2147483648<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>2147483648<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>1<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>1<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>4294967296<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>2147483648<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>2147483648<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>1<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>8<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readonly</span>&gt;</span>0<span class="tag">&lt;/<span class="name">readonly</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quotas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interval</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">duration</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">duration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">queries</span>&gt;</span>0<span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">errors</span>&gt;</span>0<span class="tag">&lt;/<span class="name">errors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">result_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">read_rows</span>&gt;</span>0<span class="tag">&lt;/<span class="name">read_rows</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution_time</span>&gt;</span>0<span class="tag">&lt;/<span class="name">execution_time</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interval</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">quotas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>default_user_password_sha256_hex<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>ch_ro_user_password_sha256_hex<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ch_ro</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>fanboshi_user_password_sha256_hex<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>fanboshi<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意看这里</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="comment">-- This file was generated automatically.</span></span><br><span class="line">     Do <span class="keyword">not</span> edit <span class="keyword">it</span>: <span class="keyword">it</span> <span class="keyword">is</span> likely <span class="keyword">to</span> be discarded <span class="keyword">and</span> generated again <span class="keyword">before</span> <span class="keyword">it</span>&#x27;s <span class="built_in">read</span> next <span class="built_in">time</span>.</span><br><span class="line">     Files used <span class="keyword">to</span> generate this <span class="built_in">file</span>:</span><br><span class="line">       /data/clickhouse/node1/users.xml</span><br><span class="line">       /data/clickhouse/node1/users.d/fanboshi.xml      <span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建用户还是比较麻烦的, 要在所有节点增加配置文件, 建议还是使用ansible之类的工具配合, 这里我给出我们现在使用的ansible role的关键部分吧, 关键就是template和var吧</p>
<p>template</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">#jinja2: lstrip_blocks:True</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;</span></span><span class="template-variable">&#123;&#123; <span class="name">user.name</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;% for key, value in profile.settings.items() %&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;</span></span><span class="template-variable">&#123;&#123; <span class="name">key</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">value</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/</span></span><span class="template-variable">&#123;&#123; <span class="name">key</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;% endfor %&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/</span></span><span class="template-variable">&#123;&#123; <span class="name">user.name</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;</span></span><span class="template-variable">&#123;&#123; <span class="name">user.name</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">password_sha256_hex</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;% for key, values in user.networks.items() %&#125;</span></span><br><span class="line"><span class="xml">              &#123;% for value in values %&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;</span></span><span class="template-variable">&#123;&#123; <span class="name">key</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">value</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/</span></span><span class="template-variable">&#123;&#123; <span class="name">key</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">              &#123;% endfor %&#125;</span></span><br><span class="line"><span class="xml">            &#123;% endfor %&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">user.name</span>|default(<span class="name">&#x27;default&#x27;</span>)&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">quota</span>|default(<span class="name">&#x27;default&#x27;</span>)&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;% if user.allow_databases|default(&#x27;&#x27;)|length &gt; 0 %&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">allow_databases</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;% for database in user.allow_databases %&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">database</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">database</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">database</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;% endfor %&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">allow_databases</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;% endif %&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/</span></span><span class="template-variable">&#123;&#123; <span class="name">user.name</span> &#125;&#125;</span><span class="xml"><span class="tag">&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>var</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># vars file for clickhouse_add_users</span></span><br><span class="line"><span class="attr">profile:</span></span><br><span class="line">  <span class="attr">settings:</span></span><br><span class="line">    <span class="attr">max_memory_usage:</span> <span class="number">54975581388</span></span><br><span class="line"><span class="comment">#    max_memory_usage_for_all_queries: 61847529062</span></span><br><span class="line">    <span class="attr">max_bytes_before_external_group_by:</span> <span class="number">21474836480</span></span><br><span class="line">    <span class="attr">max_bytes_before_external_sort:</span> <span class="number">21474836480</span></span><br><span class="line">    <span class="attr">use_uncompressed_cache:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">load_balancing:</span> <span class="string">random</span></span><br><span class="line">    <span class="attr">distributed_aggregation_memory_efficient:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_threads:</span> <span class="number">8</span></span><br><span class="line">    <span class="attr">log_queries:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">readonly:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># 不要定义password_sha256_hex, password_sha256_hex应该根据password生成</span></span><br><span class="line">  <span class="attr">networks:</span></span><br><span class="line">    <span class="attr">ip:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">::/0</span></span><br><span class="line">  <span class="attr">quota:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">allow_databases:</span> []</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="clickhouse-client-prompt调整"><a href="#clickhouse-client-prompt调整" class="headerlink" title="clickhouse-client prompt调整"></a>clickhouse-client prompt调整</h1><p>根据<a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/interfaces/cli/">官方文档</a>描述:</p>
<p><code>clickhouse-client</code> uses the first existing file of the following:</p>
<ul>
<li>Defined in the <code>--config-file</code> parameter.</li>
<li><code>./clickhouse-client.xml</code></li>
<li><code>~/.clickhouse-client/config.xml</code></li>
<li><code>/etc/clickhouse-client/config.xml</code></li>
</ul>
<p>查看<code>/etc/clickhouse-client/config.xml</code>(yum安装会自动创建这个配置), 发现有示例配置</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">prompt_by_server_display_name</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">default</span>&gt;</span></span><span class="template-variable">&#123;display_name&#125;</span><span class="xml"> :) <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">test</span>&gt;</span></span><span class="template-variable">&#123;display_name&#125;</span><span class="xml"> \x01\e[1;32m\x02:)\x01\e[0m\x02 <span class="tag">&lt;/<span class="name">test</span>&gt;</span> <span class="comment">&lt;!-- if it matched to the substring &quot;test&quot; in the server display name - --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">production</span>&gt;</span></span><span class="template-variable">&#123;display_name&#125;</span><span class="xml"> \x01\e[1;31m\x02:)\x01\e[0m\x02 <span class="tag">&lt;/<span class="name">production</span>&gt;</span> <span class="comment">&lt;!-- if it matched to the substring &quot;production&quot; in the server display name --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">prompt_by_server_display_name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>于是调整一下, 比如default改成</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">default</span>&gt;</span></span><span class="template-variable">&#123;display_name&#125;</span><span class="xml"> </span><span class="template-variable">&#123;user&#125;</span><span class="xml">@</span><span class="template-variable">&#123;host&#125;</span><span class="xml">:</span><span class="template-variable">&#123;port&#125;</span><span class="xml"> [</span><span class="template-variable">&#123;database&#125;</span><span class="xml">]\n\x01\e[1;31m\x02:)\x01\e[0m\x02 <span class="tag">&lt;/<span class="name">default</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#clickhouse-client -ufanboshi --ask-password </span></span><br><span class="line">ClickHouse<span class="built_in"> client </span>version 20.3.5.21 (official build).</span><br><span class="line">Password <span class="keyword">for</span><span class="built_in"> user </span>(fanboshi): </span><br><span class="line">Connecting <span class="keyword">to</span> localhost:9000 as<span class="built_in"> user </span>fanboshi.</span><br><span class="line">Connected <span class="keyword">to</span> ClickHouse<span class="built_in"> server </span>version 20.3.5 revision 54433.</span><br><span class="line"></span><br><span class="line">bj2-clickhouse-all-prod-01 fanboshi@localhost:9000 [default]</span><br><span class="line">:)  --其实笑脸是红色的<span class="built_in">..</span></span><br></pre></td></tr></table></figure>
<p>其实这个配置还不是很理解, 因为你可以注意到我这里使用的用户是fanboshi, 而非<code>default</code>但却也应用到了这个prompt, 我怀疑是因为profile是<code>default</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#cat /data/clickhouse/ch_9000/users.d/fanboshi.xml </span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>54975581388<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_memory_usage_for_all_queries</span>&gt;</span>61847529062<span class="tag">&lt;/<span class="name">max_memory_usage_for_all_queries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_group_by</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_group_by</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_bytes_before_external_sort</span>&gt;</span>21474836480<span class="tag">&lt;/<span class="name">max_bytes_before_external_sort</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">use_uncompressed_cache</span>&gt;</span>0<span class="tag">&lt;/<span class="name">use_uncompressed_cache</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">load_balancing</span>&gt;</span>random<span class="tag">&lt;/<span class="name">load_balancing</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span>1<span class="tag">&lt;/<span class="name">distributed_aggregation_memory_efficient</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_threads</span>&gt;</span>10<span class="tag">&lt;/<span class="name">max_threads</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">log_queries</span>&gt;</span>1<span class="tag">&lt;/<span class="name">log_queries</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>supersecurt<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fanboshi</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="实现类似mysql免输用户密码登录"><a href="#实现类似mysql免输用户密码登录" class="headerlink" title="实现类似mysql免输用户密码登录"></a>实现类似mysql免输用户密码登录</h2><p>我们都知道mysql cli可以通过在my.cnf添加如下参数实现快速登录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">user</span>=xx</span><br><span class="line"><span class="attr">password</span>=xxx</span><br></pre></td></tr></table></figure>
<p>clickhouse-client也可以</p>
<p>根据<a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/interfaces/cli/">官方文档</a>描述, 在client config文件中添加如下参数即可</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># vim ~/.clickhouse-client/config.xml </span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;config&gt;</span></span><br><span class="line">    <span class="params">&lt;user&gt;</span>username<span class="params">&lt;/user&gt;</span></span><br><span class="line">    <span class="params">&lt;password&gt;</span>password<span class="params">&lt;/password&gt;</span></span><br><span class="line">    <span class="params">&lt;secure&gt;</span>False<span class="params">&lt;/secure&gt;</span></span><br><span class="line"><span class="params">&lt;/config&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h1><p>看了很多大佬的文章, 大家都是建议给应用提供一个负载均衡写本地表读分布式表, 而不直接通过分布式表写数据</p>
<p>我们搞技术的肯定不愿意人云亦云, 别人说什么就信什么, 当然前任经验肯定是有价值的</p>
<p>不过我想来想去还是有些没想明白直接写分布式表有什么致命缺陷, 于是在<a href="(http://www.clickhouse.com.cn/topic/5ea591ffc609fc4935d80526">ClickHouse中文社区提了一个问题</a>), 内容如下:</p>
<blockquote>
<p>不过至今无人答复</p>
</blockquote>
<p>看了sina高鹏大佬的分享 看了 <a target="_blank" rel="noopener" href="https://github.com/ClickHouse/ClickHouse/issues/1854">https://github.com/ClickHouse/ClickHouse/issues/1854</a> 还看了一些文章都是建议写本地表而不是分布式表 如果我设置<code>internal_replication=true</code>, 使用<code>ReplicatedMergeTree</code>引擎, 除了写本地表更灵活可控外, 写分布式表到底有什么致命缺陷吗? 因为要给同事解释, 只说一个大家说最佳实践是这样是不行的… 我自己也没理解到底写分布式表有啥大缺陷 如果说造成数据分布不均匀, <code>sharding key</code>我设为<code>rand()</code>还会有很大不均匀吗? 如果说扩容, 我也可以通过调整<code>weight</code>控制数据尽量写入新shared啊?</p>
<p>难道是因为文档中这段:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Data is written asynchronously. When inserted <span class="keyword">in</span> <span class="keyword">the</span> table, <span class="keyword">the</span> data block is just written <span class="built_in">to</span> <span class="keyword">the</span> <span class="built_in">local</span> <span class="built_in">file</span> <span class="keyword">system</span>. The data is sent <span class="built_in">to</span> <span class="keyword">the</span> remote servers <span class="keyword">in</span> <span class="keyword">the</span> background <span class="keyword">as</span> soon <span class="keyword">as</span> possible. The period <span class="keyword">for</span> sending data is managed <span class="keyword">by</span> <span class="keyword">the</span> distributed_directory_monitor_sleep_time_ms <span class="keyword">and</span> distributed_directory_monitor_max_sleep_time_ms settings. The Distributed engine sends <span class="keyword">each</span> <span class="built_in">file</span> <span class="keyword">with</span> inserted data separately, but you can enable batch sending <span class="keyword">of</span> <span class="built_in">files</span> <span class="keyword">with</span> <span class="keyword">the</span> distributed_directory_monitor_batch_inserts setting. This setting improves cluster performance <span class="keyword">by</span> better utilizing <span class="built_in">local</span> server <span class="keyword">and</span> network resources. You should check whether data is sent successfully <span class="keyword">by</span> checking <span class="keyword">the</span> list <span class="keyword">of</span> <span class="built_in">files</span> (data waiting <span class="built_in">to</span> be sent) <span class="keyword">in</span> <span class="keyword">the</span> table <span class="built_in">directory</span>: /var/lib/clickhouse/data/database/table/.</span><br><span class="line"></span><br><span class="line">If <span class="keyword">the</span> server ceased <span class="built_in">to</span> exist <span class="keyword">or</span> had <span class="keyword">a</span> rough restart (<span class="keyword">for</span> example, <span class="keyword">after</span> <span class="keyword">a</span> device failure) <span class="keyword">after</span> <span class="keyword">an</span> INSERT <span class="built_in">to</span> <span class="keyword">a</span> Distributed table, <span class="keyword">the</span> inserted data might be lost. If <span class="keyword">a</span> damaged data part is detected <span class="keyword">in</span> <span class="keyword">the</span> table <span class="built_in">directory</span>, <span class="keyword">it</span> is transferred <span class="built_in">to</span> <span class="keyword">the</span> ‘broken’ subdirectory <span class="keyword">and</span> no longer used.</span><br></pre></td></tr></table></figure>
<p>上面文档内容我理解意思是说假如我有S1 S2 S3 三个节点,每个节点都有local表和分布式表. 我向S1的分布式表写数据1, 2, 3 1写入S1, 2,3先写到S1本地文件系统, 然后异步发送到S2 S3 , 比如2发给S2, 3发给S3, 如果此时S3宕机了, 则3发到S3失败, 但是1,2还是成功写到S1,S2了? 所以整个过程不能保证原子性? 出现问题还要人为修数据? <a target="_blank" rel="noopener" href="https://github.com/ClickHouse/ClickHouse/issues/1343">https://github.com/ClickHouse/ClickHouse/issues/1343</a> 这个issue说S3 come back后S1会尝试重新发送数据给S3.</p>
<p>Data blocks are written in /var/lib/clickhouse/data/database/table/ folder. Special thread checks directory periodically and tries to send data. If it can’t, it will try next time.</p>
<p>那么只剩文档最后一句意思是如果S1过程中宕机, 会丢数据? 再就是weight是分片级别的, 不是表级别的, 灵活性差?</p>
<p>已经有答案了, 详见<a href="http://fuxkdb.com/2020/09/22/2020-09-22-ClickHouse%E5%88%B0%E5%BA%95%E6%94%B9%E5%86%99%E6%9C%AC%E5%9C%B0%E8%A1%A8%E8%BF%98%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E8%A1%A8/">ClickHouse到底改写本地表还是分布式表</a></p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>


<script src="/js/vdonate.js"></script>

<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/css/images/WechatIMG65.jpeg',
  alipayImage: 'https://raw.githubusercontent.com/Fanduzi/Fandb.github.io/master/css/images/WechatIMG64.jpeg'
});
</script>
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>大范</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2020/05/02/2020-05-02-ClickHouse多实例部署/" target="_blank" title="ClickHouse多实例部署">http://fuxkdb.com/2020/05/02/2020-05-02-ClickHouse多实例部署/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>

      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ClickHouse/" rel="tag">ClickHouse</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/05/03/2020-05-03-%5B%E8%AF%91%E6%96%87%5DClickHouse-In-the-Storm.-Part-1-Maximum-QPS-estimation---%E6%9C%80%E5%A4%A7QPS%E4%BC%B0%E7%AE%97/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          译文-ClickHouse In the Storm. Part 1 - Maximum QPS estimation - 最大QPS估算
        
      </div>
    </a>
  
  
    <a href="/2020/04/15/2020-04-15-Zookeeper3.6.0%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Zookeeper3.6.0集群部署文档</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ClickHouse%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2"><span class="nav-number">1.</span> <span class="nav-text">ClickHouse多实例部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E8%A7%84%E5%88%92"><span class="nav-number">1.1.</span> <span class="nav-text">部署规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.</span> <span class="nav-text">依赖组件安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JDK"><span class="nav-number">1.2.1.</span> <span class="nav-text">JDK</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDopenjdk"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">下载openjdk</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%81%9A%E8%BD%AF%E9%93%BE"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">做软链</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">配置环境变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper"><span class="nav-number">1.2.2.</span> <span class="nav-text">ZooKeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">下载安装包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%81%9A%E8%BD%AF%E9%93%BE-1"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">做软链</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-1"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">配置环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">创建目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#myid"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">myid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEzk%E6%97%A5%E5%BF%97"><span class="nav-number">1.2.2.7.</span> <span class="nav-text">配置zk日志</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-zookeeper-env-sh-conf%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%B0%E5%BB%BAzookeeper-env-sh%E6%96%87%E4%BB%B6-%E4%BF%AE%E6%94%B9%E5%88%B0sudo-chmod-755-zookeeper-env-sh%E6%9D%83%E9%99%90"><span class="nav-number">1.2.2.7.1.</span> <span class="nav-text">1.zookeeper-env.sh  .&#x2F;conf目录下新建zookeeper-env.sh文件,修改到sudo chmod 755 zookeeper-env.sh权限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-log4j-properties-%E4%BF%AE%E6%94%B9%E6%97%A5%E5%BF%97%E7%9A%84%E8%BE%93%E5%85%A5%E5%BD%A2%E5%BC%8F"><span class="nav-number">1.2.2.7.2.</span> <span class="nav-text">2.log4j.properties 修改日志的输入形式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%90%E8%A1%8Czk%E7%9A%84JVM"><span class="nav-number">1.2.2.8.</span> <span class="nav-text">配置运行zk的JVM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8zookeeper%E6%9C%8D%E5%8A%A1-%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9"><span class="nav-number">1.2.2.9.</span> <span class="nav-text">启动zookeeper服务(所有节点)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81zk"><span class="nav-number">1.2.2.10.</span> <span class="nav-text">验证zk</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ClickHouse%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">ClickHouse安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#yum%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">yum安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95-1"><span class="nav-number">2.2.</span> <span class="nav-text">创建目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.3.</span> <span class="nav-text">创建配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#node1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.1.</span> <span class="nav-text">node1配置文件如下</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.2.</span> <span class="nav-text">node2配置文件如下:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml-1"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml-1"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml-1"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.3.</span> <span class="nav-text">node3配置文件如下:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml-2"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml-2"><span class="nav-number">2.3.3.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml-2"><span class="nav-number">2.3.3.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.4.</span> <span class="nav-text">node4配置文件如下:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml-3"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml-3"><span class="nav-number">2.3.4.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml-3"><span class="nav-number">2.3.4.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.5.</span> <span class="nav-text">node5配置文件如下:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml-4"><span class="nav-number">2.3.5.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml-4"><span class="nav-number">2.3.5.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml-4"><span class="nav-number">2.3.5.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">2.3.6.</span> <span class="nav-text">node6配置文件如下:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#config-xml-5"><span class="nav-number">2.3.6.1.</span> <span class="nav-text">config.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#users-xml-5"><span class="nav-number">2.3.6.2.</span> <span class="nav-text">users.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metrika-xml-5"><span class="nav-number">2.3.6.3.</span> <span class="nav-text">metrika.xml</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E7%94%9F%E6%88%90%E6%96%B9%E5%BC%8F"><span class="nav-number">2.4.</span> <span class="nav-text">用户密码生成方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%B1%9E%E4%B8%BB"><span class="nav-number">2.5.</span> <span class="nav-text">修改属主</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4"><span class="nav-number">2.6.</span> <span class="nav-text">进程守护</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ClickHouse%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="nav-number">2.7.</span> <span class="nav-text">ClickHouse服务启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4%E5%8A%9F%E8%83%BD%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="nav-number">2.8.</span> <span class="nav-text">测试集群功能是否正常</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93testdb"><span class="nav-number">2.8.1.</span> <span class="nav-text">创建数据库testdb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E8%A1%A8"><span class="nav-number">2.8.2.</span> <span class="nav-text">创建本地表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E8%A1%A8"><span class="nav-number">2.8.3.</span> <span class="nav-text">创建分布式表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81%EF%BC%9A"><span class="nav-number">2.8.4.</span> <span class="nav-text">验证数据复制状态：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E5%88%86%E7%89%871%E7%BB%84%E7%9A%84%E5%86%99%E5%85%A5%E8%8A%82%E7%82%B9%E7%9A%84local%E8%A1%A8"><span class="nav-number">2.8.4.1.</span> <span class="nav-text">写入分片1组的写入节点的local表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%871%E7%BB%84local%E8%A1%A8%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.2.</span> <span class="nav-text">在分片1组local表可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%871-%E5%89%AF%E6%9C%AC%E8%8A%82%E7%82%B9local%E8%AF%BB%E5%8F%96%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.3.</span> <span class="nav-text">在分片1 副本节点local读取可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E5%88%86%E7%89%872%E7%BB%84%E7%9A%84%E5%86%99%E5%85%A5%E8%8A%82%E7%82%B9%E7%9A%84local%E8%A1%A8"><span class="nav-number">2.8.4.4.</span> <span class="nav-text">写入分片2组的写入节点的local表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%872%E7%BB%84local%E8%A1%A8%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.5.</span> <span class="nav-text">在分片2组local表可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%872-%E5%89%AF%E6%9C%AC%E8%8A%82%E7%82%B9local%E8%AF%BB%E5%8F%96%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.6.</span> <span class="nav-text">在分片2 副本节点local读取可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E5%88%86%E7%89%873%E7%BB%84%E7%9A%84%E5%86%99%E5%85%A5%E8%8A%82%E7%82%B9%E7%9A%84local%E8%A1%A8"><span class="nav-number">2.8.4.7.</span> <span class="nav-text">写入分片3组的写入节点的local表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%873%E7%BB%84local%E8%A1%A8%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.8.</span> <span class="nav-text">在分片3组local表可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%88%86%E7%89%873-%E5%89%AF%E6%9C%AC%E8%8A%82%E7%82%B9local%E8%AF%BB%E5%8F%96%E5%8F%AF%E8%A7%81%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="nav-number">2.8.4.9.</span> <span class="nav-text">在分片3 副本节点local读取可见一条记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Distributed%E8%A1%A8%E9%AA%8C%E8%AF%81"><span class="nav-number">2.8.4.10.</span> <span class="nav-text">Distributed表验证</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#macros%E5%BB%BA%E8%A1%A8"><span class="nav-number">2.8.5.</span> <span class="nav-text">macros建表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ClickHouse%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">ClickHouse用户管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#clickhouse-client-prompt%E8%B0%83%E6%95%B4"><span class="nav-number">4.</span> <span class="nav-text">clickhouse-client prompt调整</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%BC%BCmysql%E5%85%8D%E8%BE%93%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95"><span class="nav-number">4.1.</span> <span class="nav-text">实现类似mysql免输用户密码登录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%96%91%E9%97%AE"><span class="nav-number">5.</span> <span class="nav-text">疑问</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2022 Fan() All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>





  
<script src="/js/dialog.js"></script>









	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Fan()
          </div>
          <div class="panel-body">
            Copyright © 2022 大范 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>