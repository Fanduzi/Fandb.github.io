<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Fan()</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Fan()">
<meta property="og:url" content="http://fuxkdb.com/page/17/index.html">
<meta property="og:site_name" content="Fan()">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="大范">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Fan()" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpeg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpeg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 5.1.1"></head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/1.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/2.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="/css/images/3.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="/css/images/4.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="/css/images/5.jpeg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">Fan()</a></h1>
            <h3></h3>
            <h5>大范</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-docopt详解"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/28/docopt%E8%AF%A6%E8%A7%A3/">docopt详解</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/28/docopt%E8%AF%A6%E8%A7%A3/" class="article-date">
	  <time datetime="2017-06-28T14:00:00.000Z" itemprop="datePublished">2017-06-28</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Naval Fate.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  naval_fate ship <span class="keyword">new</span> <span class="symbol">&lt;name&gt;</span>...</span><br><span class="line">  naval_fate ship <span class="symbol">&lt;name&gt;</span> <span class="keyword">move</span> <span class="symbol">&lt;x&gt;</span> <span class="symbol">&lt;y&gt;</span> [--speed=<span class="symbol">&lt;kn&gt;</span>]</span><br><span class="line">  naval_fate ship shoot <span class="symbol">&lt;x&gt;</span> <span class="symbol">&lt;y&gt;</span></span><br><span class="line">  naval_fate mine (<span class="keyword">set</span>|<span class="built_in">remove</span>) <span class="symbol">&lt;x&gt;</span> <span class="symbol">&lt;y&gt;</span> [--moored|--drifting]</span><br><span class="line">  naval_fate -h | --<span class="keyword">help</span></span><br><span class="line">  naval_fate --<span class="keyword">version</span></span><br><span class="line"></span><br><span class="line">Option<span class="variable">s:</span></span><br><span class="line">  -h --<span class="keyword">help</span>     Show this screen.</span><br><span class="line">  --<span class="keyword">version</span>     Show <span class="keyword">version</span>.</span><br><span class="line">  --speed=<span class="symbol">&lt;kn&gt;</span>  Speed in knots [defaul<span class="variable">t:</span> <span class="number">10</span>].</span><br><span class="line">  --moored      Moored (anchored) mine.</span><br><span class="line">  --drifting    Drifting mine.</span><br></pre></td></tr></table></figure>
<p>该示例描述了可执行的naval_fate的界面，可以使用命令(ship，new，move等)的不同组合，选项(-h，–help，–speed = <kn>等)和 位置参数(<name>，<x>，<y>).</p>
<p>示例使用方括号“[]”，圆括号“()”，管道“|” 和省略号“…”来描述可选的，必需的，相互排斥的和重复的元素. 一起，这些元素形成有效的使用模式，每个都以程序的名称naval_fate开头.</p>
<p>Below the usage patterns，有一个包含说明的选项列表. 它们描述一个选项是否具有短/长形式(-h，–help)，选项是否具有参数(-speed = <kn>)，以及该参数是否具有默认值([default:10]).</p>
<h3 id="Usage模式"><a href="#Usage模式" class="headerlink" title="Usage模式"></a>Usage模式</h3><p>在Usage:(不区分大小写) 关键字 间出现,并且显示的空了一行的部分 被解释为 usage pattern<br>在”Usage:”后出现的第一个单词被解释为程序的名字. 下面是一个最简单的示例,该示例没有任何命令行参数<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#### Usage: my_program</span><br></pre></td></tr></table></figure><br>程序可以使用用于描述模式的各种元素列出几个模式:<br><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  my_program command --option &lt;argument&gt;</span><br><span class="line">  my_program <span class="meta">[&lt;optional-argument&gt;]</span></span><br><span class="line">  my_program --another-option=&lt;<span class="keyword">with</span>-argument&gt;</span><br><span class="line">  my_program (--either-that-option | &lt;<span class="keyword">or</span>-this-argument&gt;)</span><br><span class="line">  my_program &lt;repeating-argument&gt; &lt;repeating-argument&gt;...</span><br></pre></td></tr></table></figure></p>
<h4 id="ARGUMENT"><a href="#ARGUMENT" class="headerlink" title=" ARGUMENT"></a><argument> ARGUMENT</h4>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-传统复制在线切换到GTID模式"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/17/%E4%BC%A0%E7%BB%9F%E5%A4%8D%E5%88%B6%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E5%88%B0GTID%E6%A8%A1%E5%BC%8F/">传统复制在线切换到GTID模式</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/17/%E4%BC%A0%E7%BB%9F%E5%A4%8D%E5%88%B6%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E5%88%B0GTID%E6%A8%A1%E5%BC%8F/" class="article-date">
	  <time datetime="2017-06-17T14:00:00.000Z" itemprop="datePublished">2017-06-17</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="传统复制切换到GTID模式"><a href="#传统复制切换到GTID模式" class="headerlink" title="传统复制切换到GTID模式"></a>传统复制切换到GTID模式</h2><p>5.7.6以后参数<code>gtid_mode</code>可以动态修改<br>GTID_MODE:</p>
<ul>
<li><p>OFF </p>
<blockquote>
<p>彻底关闭GTID,如果关闭状态的备库接受到带GTID的事务,则复制中断</p>
</blockquote>
</li>
<li><p>OFF_PERMISSIVE </p>
<blockquote>
<p>可以认为是关闭GTID前的过渡阶段,主库在设置成该值后不再生成GTID,备库在接受到带GTID 和不带GTID的事务都可以容忍<br>主库在关闭GTID时,执行事务会产生一个Anonymous_Gtid事件,会在备库执行:<br>SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’<br>备库在执行匿名事务时,就不会去尝试生成本地GTID了</p>
</blockquote>
</li>
<li><p>ON_PERMISSIVE</p>
<blockquote>
<p>可以认为是打开GTID前的过渡阶段,主库在设置成该值后会产生GTID,同时备库依然容忍带GTID和不带GTID的事务</p>
</blockquote>
</li>
<li><p>ON</p>
<blockquote>
<p>完全打开GTID,如果打开状态的备库接受到不带GTID的事务,则复制中断</p>
</blockquote>
</li>
</ul>
<p>准备工作<br>1.拓扑中的所有服务器都必须使用MySQL 5.7.6或更高版本. 除非拓扑中的所有服务器都使用此版本,否则无法在任何单个服务器上启用GTID事务.<br>2.所有服务器都将gtid_mode设置为默认值OFF.</p>
<p>The following procedure can be paused at any time and later resumed where it was, or reversed by jumping to the corresponding step of Section 16.1.5.3, “Disabling GTID Transactions Online”, the online procedure to disable GTIDs. This makes the procedure fault-tolerant because any unrelated issues that may appear in the middle of the procedure can be handled as usual, and then the procedure continued where it was left off.<br>切换过程可以再任意时刻停止,并稍后继续执行</p>
<blockquote>
<p>注意<br>在每一步执行完全完成后再执行下一步</p>
</blockquote>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-主从切换实例(传统复制)"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/06/13/%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E5%AE%9E%E4%BE%8B(%E4%BC%A0%E7%BB%9F%E5%A4%8D%E5%88%B6)/">主从切换实例(传统复制)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/13/%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2%E5%AE%9E%E4%BE%8B(%E4%BC%A0%E7%BB%9F%E5%A4%8D%E5%88%B6)/" class="article-date">
	  <time datetime="2017-06-13T14:00:00.000Z" itemprop="datePublished">2017-06-13</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="主从切换案例"><a href="#主从切换案例" class="headerlink" title="主从切换案例"></a>主从切换案例</h3><p>M为主库,read write<br>S* 为从库,read only<br>现在要对M进行硬件维护,提升S1为主库,接管业务读写. M维护完成后作为从库,如下图<br><img src="https://raw.githubusercontent.com/Fanduzi/auto_failover/master/image/Snip20170626_32.png" alt="img"><br>首先可以进行如下切换 (A)<br><img src="https://raw.githubusercontent.com/Fanduzi/auto_failover/master/image/Snip20170626_33.png" alt="img"><br>再进行如下切换(B)<br><img src="https://raw.githubusercontent.com/Fanduzi/auto_failover/master/image/Snip20170626_34.png" alt="img"></p>
<h4 id="A切换步骤"><a href="#A切换步骤" class="headerlink" title="A切换步骤"></a>A切换步骤</h4><p>首先在S1制造”错误”<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> sql_log_bin=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_error_maker(<span class="keyword">id</span> <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> sql_log_bin=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t_error_maker;</span><br></pre></td></tr></table></figure><br>通过在session级别关闭写入binlog,建表,开启写入binlog,删表 制造异常, 当S11 S12 S13都执行到drop语句时,会报错停止sql_thread.<br>通过这种方式,可以让它们停止在同一个位置.<br>S12<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span> 获取<span class="keyword">File</span> <span class="keyword">Position</span></span><br></pre></td></tr></table></figure><br>S11 S13<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span>到S12上</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br></pre></td></tr></table></figure><br>S12<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> sql_slave_skip_counter=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span> sql_thread;</span><br></pre></td></tr></table></figure></p>
<h4 id="B切换步骤"><a href="#B切换步骤" class="headerlink" title="B切换步骤"></a>B切换步骤</h4><p>M 停止业务写操作<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> read_only=<span class="keyword">on</span>; 此时只有super权限用户能写入</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> super_read_only=<span class="keyword">on</span>;禁止super权限用户写</span><br><span class="line"><span class="comment">#这里没有通过修改用户密码的方式是因为修改用户密码对已经连接上来的用户无效</span></span><br></pre></td></tr></table></figure><br>等M S1 S12 跑一致后(File Position相同) 停S12 sql_thread, 将业务写入操作接入S1<br>最后M<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> read_only=<span class="keyword">off</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> super_read_only=<span class="keyword">off</span>;</span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> 到S12</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span></span><br></pre></td></tr></table></figure><br>S12<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span> sql_thread;</span><br></pre></td></tr></table></figure></p>
<p>以上步骤通过脚本完成的话,可以做到对业务造成很小的影响<br>脚本实例如下,注释掉了B步骤,因为需要配合切换业务写入操作<br>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-Tpcc-MySQL"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/05/07/Tpcc-MySQL/">Tpcc-MySQL</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/05/07/Tpcc-MySQL/" class="article-date">
	  <time datetime="2017-05-07T14:00:00.000Z" itemprop="datePublished">2017-05-07</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tpcc-MySQL"><a href="#Tpcc-MySQL" class="headerlink" title="Tpcc-MySQL"></a>Tpcc-MySQL</h2><h3 id="下载安装tpcc-mysql"><a href="#下载安装tpcc-mysql" class="headerlink" title="下载安装tpcc-mysql"></a>下载安装tpcc-mysql</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local</span><br><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/Percona-Lab/</span>tpcc-mysql<span class="regexp">/archive/m</span>aster.zip</span><br><span class="line">mv tpcc-mysql-master tpcc-mysql</span><br></pre></td></tr></table></figure>
<h3 id="安装之前需要保证将mysql-config添加到-PATH-环境变量中"><a href="#安装之前需要保证将mysql-config添加到-PATH-环境变量中" class="headerlink" title="安装之前需要保证将mysql_config添加到$PATH 环境变量中"></a>安装之前需要保证将mysql_config添加到$PATH 环境变量中</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd src <span class="comment">; make ( you should have mysql_config available in $PATH)</span></span><br></pre></td></tr></table></figure>
<h3 id="初始化数据"><a href="#初始化数据" class="headerlink" title="初始化数据"></a>初始化数据</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[mysql@master ~]$ mysqladmin -umysql -p -S /data/mysqldata/3306/mysql.sock create tpcc10</span><br><span class="line">Enter password: </span><br><span class="line">[mysql@master ~]$ mysql -umysql -pmysql -S  /data/mysqldata/3306/mysql.sock tpcc10 &lt; /usr/local/tpcc-mysql/create_table.sql </span><br><span class="line">Warning: Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br><span class="line">[mysql@master ~]$ mysql -umysql -pmysql -S  /data/mysqldata/3306/mysql.sock -e  <span class="string">&quot; show tables from tpcc10;&quot;</span></span><br><span class="line">Warning: Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br><span class="line">+------------------+</span><br><span class="line">| Tables_in_tpcc10 |</span><br><span class="line">+------------------+</span><br><span class="line">|<span class="built_in"> customer </span>        |</span><br><span class="line">| district         |</span><br><span class="line">| history          |</span><br><span class="line">| item             |</span><br><span class="line">| new_orders       |</span><br><span class="line">| order_line       |</span><br><span class="line">| orders           |</span><br><span class="line">| stock            |</span><br><span class="line">| warehouse        |</span><br><span class="line">+------------------+</span><br><span class="line">[mysql@master ~]$ mysql -umysql -pmysql -S  /data/mysqldata/3306/mysql.sock tpcc10 &lt; /usr/local/tpcc-mysql/add_fkey_idx.sql </span><br><span class="line">Warning: Using a password on the command line<span class="built_in"> interface </span>can be insecure.</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-MySQL升级"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/03/03/MySQL%E5%8D%87%E7%BA%A7/">MySQL升级</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/03/MySQL%E5%8D%87%E7%BA%A7/" class="article-date">
	  <time datetime="2017-03-03T14:00:00.000Z" itemprop="datePublished">2017-03-03</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Upgrading-Mysql"><a href="#Upgrading-Mysql" class="headerlink" title="Upgrading Mysql"></a>Upgrading Mysql</h2><ul>
<li>支持的升级方法</li>
<li>支持的升级路径</li>
<li>Before You Begin</li>
<li>Performing an In-Place Upgrade</li>
</ul>
<h3 id="Supported-Upgrade-Method"><a href="#Supported-Upgrade-Method" class="headerlink" title="Supported Upgrade Method"></a>Supported Upgrade Method</h3><p>支持的升级方法包括:</p>
<ul>
<li>In-Place Upgrade:涉及关闭旧版本的MySQL,将旧的MySQL二进制文件或软件包替换成新版本的MySQL,重新启动MySQL使用原来的data directory,并执行mysql_upgrade.</li>
<li>Logical Upgrade:涉及使用mysqldump导出旧版本MySQL的所有数据,安装新版本的MySQL,导入dump文件,并执行mysql_upgrade.</li>
</ul>
<h3 id="支持的升级路径"><a href="#支持的升级路径" class="headerlink" title="支持的升级路径"></a>支持的升级路径</h3><p>除非另有说明，否则支持以下升级路径：</p>
<ul>
<li>Upgrading from a release series version to a newer release series version is supported.可以从5.7.9升级到5.7.10,或者直接从5.7.9升级到5.7.11</li>
<li>Upgrading one release level is supported. For example, upgrading from 5.6 to 5.7 is supported.可以从5.6升级到5.7</li>
<li>Upgrading more than one release level is supported, but only if you upgrade one release level at a time.升级多个版本是支持的但只能一次升级一个版本,比如5.5 先升级 5.6 再升级到5.7</li>
<li>直接从5.5升级到5.7是不建议且不支持的<br>以下条件适用于所有升级路径：</li>
<li>支持通用可用性（GA）状态版本之间的升级。</li>
<li>不支持在里程碑版本之间（或从里程碑版本到GA版本）的升级。 <del>例如，不支持从5.7.7升级到5.7.8，因为GA状态释放也不受支持(这段可能写错了)</del>。</li>
<li>对于已达到GA状态的MySQL版本系列的版本之间的升级，可以在具有相同架构的系统上在不同版本之间移动MySQL格式文件和数据文件。 这对于在里程碑版本之间的升级不一定是真的。 使用里程碑版本是您自己的风险。</li>
</ul>
<h3 id="Before-You-Begin"><a href="#Before-You-Begin" class="headerlink" title="Before You Begin"></a>Before You Begin</h3><p>升级之前,建议查看如下信息,并执行建议的步骤:</p>
<ul>
<li>升级前,备份数据,尤其是system库.</li>
<li>请查看版本说明，提供有关MySQL 5.7中新增功能的信息或与早期MySQL版本中发现的功能不同的信息。 其中一些更改可能导致不兼容。对于已在MySQL 5.7中添加，弃用或删除的MySQL服务器变量和选项的列表，请参见第1.5节“在MySQL 5.7中添加，弃用或删除的服务器和状态变量及选项”。如果使用以上任何项目，升级需要更改配置。</li>
<li>查看第2.11.1.1节“影响升级到MySQL 5.7的更改”。本节介绍可能需要在升级之前或之后执行操作的更改。</li>
<li>检查第2.11.3节“检查表或索引是否必须重新构建”，以了解您当前版本的MySQL与要升级的版本之间是否对表格式或字符集或归类进行了更改。如果这些更改导致MySQL版本之间不兼容，则需要使用第2.11.4节“重建或修复表或索引”中的说明升级受影响的表。</li>
<li>如果使用复制，请查看第18.4.3节“升级复制设置”。</li>
<li>如果您使用XA事务与InnoDB，请在升级之前运行XA RECOVER以检查未提交的XA事务。如果返回结果，则通过发出XA COMMIT或XA ROLLBACK语句来提交或回滚XA事务。</li>
<li>如果您的MySQL安装包含大量数据，在就地升级后可能需要很长时间进行转换，您可能会发现创建一个“虚拟”数据库实例，用于评估可能需要的转换和涉及的工作执行它们。制作一份包含mysql数据库完整副本的MySQL实例的副本，以及没有数据的所有其他数据库。在此虚拟实例上运行升级过程，以查看可能需要执行哪些操作，以便在原始数据库实例上执行实际数据转换时，可以更好地评估所涉及的工作。</li>
<li>当您安装或升级到新版本的MySQL时，建议重建和重新安装MySQL语言接口。这适用于MySQL接口，如PHP mysql扩展，Perl DBD :: mysql模块和Python MySQLdb模块。
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-MySQL误DROP表恢复,innodb_file_per_table=OFF"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/12/27/MySQL%E8%AF%AFDROP%E8%A1%A8%E6%81%A2%E5%A4%8D,innodb_file_per_table=OFF/">MySQL误DROP表恢复,innodb_file_per_table=OFF</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/12/27/MySQL%E8%AF%AFDROP%E8%A1%A8%E6%81%A2%E5%A4%8D,innodb_file_per_table=OFF/" class="article-date">
	  <time datetime="2016-12-27T14:00:00.000Z" itemprop="datePublished">2016-12-27</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL误DROP表恢复-innodb-file-per-table-OFF"><a href="#MySQL误DROP表恢复-innodb-file-per-table-OFF" class="headerlink" title="MySQL误DROP表恢复,innodb_file_per_table=OFF"></a>MySQL误DROP表恢复,innodb_file_per_table=OFF</h1><p>原文<a target="_blank" rel="noopener" href="https://twindb.com/recover-after-drop-table-innodb_file_per_table-is-off/">https://twindb.com/recover-after-drop-table-innodb_file_per_table-is-off/</a></p>
<h2 id="Undrop-for-innodb安装"><a href="#Undrop-for-innodb安装" class="headerlink" title="Undrop-for-innodb安装"></a>Undrop-for-innodb安装</h2><p>详见<a target="_blank" rel="noopener" href="https://github.com/chhabhaiya/undrop-for-innodb">https://github.com/chhabhaiya/undrop-for-innodb</a></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>误操作是不可避免的.错误的DROP DATABASE或DROP TABLE会摧毁重要的数据,更悲剧的是备份又不可用.<br>恢复方法取决于InnoDB是将所有数据保存在单个ibdata1中还是每个表都有自己的表空间.在这篇文章中,我们将考虑innodb_file_per_table = OFF的情况.此选项假定所有表都存储在通用文件中,通常位于/var/lib/mysql/ibdata1.</p>
<h2 id="误删表恢复"><a href="#误删表恢复" class="headerlink" title="误删表恢复"></a>误删表恢复</h2><p>这里使用sakila库,假设我们误删除了actor表<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM actor LIMIT 10;</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+--------------+</span>---------------------+</span><br><span class="line">| actor<span class="emphasis">_id | first_</span>name | last<span class="emphasis">_name    | last_</span>update         |</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+--------------+</span>---------------------+</span><br><span class="line">|        1 | PENELOPE   | GUINESS      | 2006-02-15 04:34:33 |</span><br><span class="line">|        2 | NICK       | WAHLBERG     | 2006-02-15 04:34:33 |</span><br><span class="line">|        3 | ED         | CHASE        | 2006-02-15 04:34:33 |</span><br><span class="line">|        4 | JENNIFER   | DAVIS        | 2006-02-15 04:34:33 |</span><br><span class="line">|        5 | JOHNNY     | LOLLOBRIGIDA | 2006-02-15 04:34:33 |</span><br><span class="line">|        6 | BETTE      | NICHOLSON    | 2006-02-15 04:34:33 |</span><br><span class="line">|        7 | GRACE      | MOSTEL       | 2006-02-15 04:34:33 |</span><br><span class="line">|        8 | MATTHEW    | JOHANSSON    | 2006-02-15 04:34:33 |</span><br><span class="line">|        9 | JOE        | SWANK        | 2006-02-15 04:34:33 |</span><br><span class="line">|       10 | CHRISTIAN  | GABLE        | 2006-02-15 04:34:33 |</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+--------------+</span>---------------------+</span><br><span class="line">10 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">查看一下checksum</span><br><span class="line">mysql&gt; CHECKSUM TABLE actor;</span><br><span class="line"><span class="code">+--------------+</span>------------+</span><br><span class="line">| Table        | Checksum   |</span><br><span class="line"><span class="code">+--------------+</span>------------+</span><br><span class="line">| sakila.actor | 1702520518 |</span><br><span class="line"><span class="code">+--------------+</span>------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select count(<span class="strong">*) from actor;</span></span><br><span class="line"><span class="strong">+----------+</span></span><br><span class="line"><span class="strong">| count(*</span>) |</span><br><span class="line"><span class="code">+----------+</span></span><br><span class="line">|      200 |</span><br><span class="line"><span class="code">+----------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; DROP TABLE actor;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure><br>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/16/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/18/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2021 Fan() All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>



  
<script src="/js/home.js"></script>











	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Fan()
          </div>
          <div class="panel-body">
            Copyright © 2021 大范 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>