<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Fan()</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Fan()">
<meta property="og:url" content="http://fuxkdb.com/page/10/index.html">
<meta property="og:site_name" content="Fan()">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="大范">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Fan()" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpeg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpeg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 5.1.1"></head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/1.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/2.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="/css/images/3.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="/css/images/4.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="/css/images/5.jpeg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">Fan()</a></h1>
            <h3></h3>
            <h5>大范</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-如何做好MySQL的备份"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/04/28/%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BDMySQL%E7%9A%84%E5%A4%87%E4%BB%BD/">如何做好MySQL的备份</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/04/28/%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BDMySQL%E7%9A%84%E5%A4%87%E4%BB%BD/" class="article-date">
	  <time datetime="2018-04-27T16:23:00.000Z" itemprop="datePublished">2018-04-28</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="如何做好MySQL的备份"><a href="#如何做好MySQL的备份" class="headerlink" title="如何做好MySQL的备份"></a>如何做好MySQL的备份</h1><h2 id="物理备份还是逻辑备份"><a href="#物理备份还是逻辑备份" class="headerlink" title="物理备份还是逻辑备份?"></a>物理备份还是逻辑备份?</h2><p>其实物理备份和逻辑备份并没有好坏之分, 关键是要适合你的场景. </p>
<h3 id="两种备份方式的备份工具有"><a href="#两种备份方式的备份工具有" class="headerlink" title="两种备份方式的备份工具有:"></a>两种备份方式的备份工具有:</h3><ul>
<li>逻辑备份工具: [mysqldump, mysqlpump, mydumper, select into out file]</li>
<li>物理备份工具: [xtrabackup, TokuBackup, Tokudb-xtrabackup]</li>
</ul>
<h3 id="两种备份方式的对比如下"><a href="#两种备份方式的对比如下" class="headerlink" title="两种备份方式的对比如下"></a>两种备份方式的对比如下</h3><ul>
<li>备份速度<br>  物理备份比逻辑备份快吗? 不要想当然, 至少我的测试结果并不是这样</li>
<li>恢复速度<br>  物理备份恢复实际就是mv操作(使用xtrabackup,在备份机做prepare), 而逻辑备份则是漫长的导入.<br>  同机器 1.5T库, 逻辑备份大小151G, 做恢复需要27小时左右, 而物理备份恢复则完全取决于磁盘iops, 不用测也知道要比逻辑备份快很多</li>
<li>备份集大小<br>  实际测试1T的库(大部分为InnoDB表), 逻辑备份集大小为<code>46G</code>, 而物理备份为<code>255G</code></li>
</ul>
<p>根据以上三点, 就可以选择备份方式了吗? 我认为不能. 还有一点是数据库服务器和备份服务器之间的网络情况, 和你期望的恢复时间是多久</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-Load-data奇怪的问题"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/03/Load-data%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98/">Load data奇怪的问题</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/03/Load-data%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
	  <time datetime="2018-03-03T07:26:00.000Z" itemprop="datePublished">2018-03-03</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Load-data奇怪的问题"><a href="#Load-data奇怪的问题" class="headerlink" title="Load data奇怪的问题"></a>Load data奇怪的问题</h1><p>公司一套所谓的BI库(5.5 innodb引擎),由于太大了,考虑转用TokuDB引擎,最近在测试,直接在一个新环境安装Percona5.7.21,然后恢复备份,转换为TokuDB表, 再做从库和原5.5库同步(5.5 是statement格式)<br>准备同步上,然后这套环境部署一下应用,再全面的测一下.<br>结果发现同步报错了<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">root@localhost</span> <span class="attr">10:42:</span>  [<span class="string">test</span>]<span class="string">&gt;</span> <span class="string">show</span> <span class="string">slave</span> <span class="string">status\G</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">               <span class="attr">Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line">                  <span class="attr">Master_Host:</span> <span class="string">xx.xx.xx.xx</span></span><br><span class="line">                  <span class="attr">Master_User:</span> <span class="string">slave</span></span><br><span class="line">                  <span class="attr">Master_Port:</span> <span class="number">3306</span></span><br><span class="line">                <span class="attr">Connect_Retry:</span> <span class="number">60</span></span><br><span class="line">              <span class="attr">Master_Log_File:</span> <span class="string">mysql-bin.010346</span></span><br><span class="line">          <span class="attr">Read_Master_Log_Pos:</span> <span class="number">715054772</span></span><br><span class="line">               <span class="attr">Relay_Log_File:</span> <span class="string">mysql-relay.000010</span></span><br><span class="line">                <span class="attr">Relay_Log_Pos:</span> <span class="number">376792000</span></span><br><span class="line">        <span class="attr">Relay_Master_Log_File:</span> <span class="string">mysql-bin.010288</span></span><br><span class="line">             <span class="attr">Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line">            <span class="attr">Slave_SQL_Running:</span> <span class="literal">No</span></span><br><span class="line">              <span class="attr">Replicate_Do_DB:</span> </span><br><span class="line">          <span class="attr">Replicate_Ignore_DB:</span> </span><br><span class="line">           <span class="attr">Replicate_Do_Table:</span> </span><br><span class="line">       <span class="attr">Replicate_Ignore_Table:</span> </span><br><span class="line">      <span class="attr">Replicate_Wild_Do_Table:</span> </span><br><span class="line">  <span class="attr">Replicate_Wild_Ignore_Table:</span> <span class="string">mysql.%,information_schema.%,performance_schema.%,union_log%.%,test.%</span></span><br><span class="line">                   <span class="attr">Last_Errno:</span> <span class="number">1300</span></span><br><span class="line">                   <span class="attr">Last_Error:</span> <span class="string">Coordinator</span> <span class="string">stopped</span> <span class="string">because</span> <span class="string">there</span> <span class="string">were</span> <span class="string">error(s)</span> <span class="string">in</span> <span class="string">the</span> <span class="string">worker(s).</span> <span class="attr">The most recent failure being:</span> <span class="string">Worker</span> <span class="number">1</span> <span class="string">failed</span> <span class="string">executing</span> <span class="string">transaction</span> <span class="string">&#x27;ANONYMOUS&#x27;</span> <span class="string">at</span> <span class="string">master</span> <span class="string">log</span> <span class="string">mysql-bin.010288,</span> <span class="string">end_log_pos</span> <span class="number">378517485</span><span class="string">.</span> <span class="string">See</span> <span class="string">error</span> <span class="string">log</span> <span class="string">and/or</span> <span class="string">performance_schema.replication_applier_status_by_worker</span> <span class="string">table</span> <span class="string">for</span> <span class="string">more</span> <span class="string">details</span> <span class="string">about</span> <span class="string">this</span> <span class="string">failure</span> <span class="string">or</span> <span class="string">others,</span> <span class="string">if</span> <span class="string">any.</span></span><br><span class="line">                 <span class="attr">Skip_Counter:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">Exec_Master_Log_Pos:</span> <span class="number">376791811</span></span><br><span class="line">              <span class="attr">Relay_Log_Space:</span> <span class="number">74984691638</span></span><br><span class="line">              <span class="attr">Until_Condition:</span> <span class="string">None</span></span><br><span class="line">               <span class="attr">Until_Log_File:</span> </span><br><span class="line">                <span class="attr">Until_Log_Pos:</span> <span class="number">0</span></span><br><span class="line">           <span class="attr">Master_SSL_Allowed:</span> <span class="literal">No</span></span><br><span class="line">           <span class="attr">Master_SSL_CA_File:</span> </span><br><span class="line">           <span class="attr">Master_SSL_CA_Path:</span> </span><br><span class="line">              <span class="attr">Master_SSL_Cert:</span> </span><br><span class="line">            <span class="attr">Master_SSL_Cipher:</span> </span><br><span class="line">               <span class="attr">Master_SSL_Key:</span> </span><br><span class="line">        <span class="attr">Seconds_Behind_Master:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="attr">Master_SSL_Verify_Server_Cert:</span> <span class="literal">No</span></span><br><span class="line">                <span class="attr">Last_IO_Errno:</span> <span class="number">0</span></span><br><span class="line">                <span class="attr">Last_IO_Error:</span> </span><br><span class="line">               <span class="attr">Last_SQL_Errno:</span> <span class="number">1300</span></span><br><span class="line">               <span class="attr">Last_SQL_Error:</span> <span class="string">Coordinator</span> <span class="string">stopped</span> <span class="string">because</span> <span class="string">there</span> <span class="string">were</span> <span class="string">error(s)</span> <span class="string">in</span> <span class="string">the</span> <span class="string">worker(s).</span> <span class="attr">The most recent failure being:</span> <span class="string">Worker</span> <span class="number">1</span> <span class="string">failed</span> <span class="string">executing</span> <span class="string">transaction</span> <span class="string">&#x27;ANONYMOUS&#x27;</span> <span class="string">at</span> <span class="string">master</span> <span class="string">log</span> <span class="string">mysql-bin.010288,</span> <span class="string">end_log_pos</span> <span class="number">378517485</span><span class="string">.</span> <span class="string">See</span> <span class="string">error</span> <span class="string">log</span> <span class="string">and/or</span> <span class="string">performance_schema.replication_applier_status_by_worker</span> <span class="string">table</span> <span class="string">for</span> <span class="string">more</span> <span class="string">details</span> <span class="string">about</span> <span class="string">this</span> <span class="string">failure</span> <span class="string">or</span> <span class="string">others,</span> <span class="string">if</span> <span class="string">any.</span></span><br><span class="line">  <span class="attr">Replicate_Ignore_Server_Ids:</span> </span><br><span class="line">             <span class="attr">Master_Server_Id:</span> <span class="number">12</span></span><br><span class="line">                  <span class="attr">Master_UUID:</span> </span><br><span class="line">             <span class="attr">Master_Info_File:</span> <span class="string">mysql.slave_master_info</span></span><br><span class="line">                    <span class="attr">SQL_Delay:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">SQL_Remaining_Delay:</span> <span class="literal">NULL</span></span><br><span class="line">      <span class="attr">Slave_SQL_Running_State:</span> </span><br><span class="line">           <span class="attr">Master_Retry_Count:</span> <span class="number">86400</span></span><br><span class="line">                  <span class="attr">Master_Bind:</span> </span><br><span class="line">      <span class="attr">Last_IO_Error_Timestamp:</span> </span><br><span class="line">     <span class="attr">Last_SQL_Error_Timestamp:</span> <span class="number">180402</span> <span class="number">00</span><span class="string">:07:09</span></span><br><span class="line">               <span class="attr">Master_SSL_Crl:</span> </span><br><span class="line">           <span class="attr">Master_SSL_Crlpath:</span> </span><br><span class="line">           <span class="attr">Retrieved_Gtid_Set:</span> </span><br><span class="line">            <span class="attr">Executed_Gtid_Set:</span> <span class="string">a3f4b929-31a0-11e8-9714-f8bc123346cc:1-864</span></span><br><span class="line">                <span class="attr">Auto_Position:</span> <span class="number">0</span></span><br><span class="line">         <span class="attr">Replicate_Rewrite_DB:</span> </span><br><span class="line">                 <span class="attr">Channel_Name:</span> </span><br><span class="line">           <span class="attr">Master_TLS_Version:</span> </span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure><br>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-5.5.x升级5.7.21步骤"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/11/5.5.x%E5%8D%87%E7%BA%A75.7.21%E6%AD%A5%E9%AA%A4/">5.5.x升级5.7.21步骤</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/02/11/5.5.x%E5%8D%87%E7%BA%A75.7.21%E6%AD%A5%E9%AA%A4/" class="article-date">
	  <time datetime="2018-02-11T03:22:00.000Z" itemprop="datePublished">2018-02-11</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="5-5-x升级5-7-21步骤"><a href="#5-5-x升级5-7-21步骤" class="headerlink" title="5.5.x升级5.7.21步骤"></a>5.5.x升级5.7.21步骤</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="上传软件包"><a href="#上传软件包" class="headerlink" title="上传软件包"></a>上传软件包</h3><p>根据官方文档说明</p>
<blockquote>
<p>Upgrading to the latest release is recommended before upgrading to the next version</p>
</blockquote>
<p>当前版本5.5.46,需要上传三个包</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>-<span class="number">5</span>.<span class="number">5</span>.<span class="number">59</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz</span><br><span class="line"><span class="attribute">mysql</span>-<span class="number">5</span>.<span class="number">6</span>.<span class="number">39</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz</span><br><span class="line"><span class="attribute">mysql</span>-<span class="number">5</span>.<span class="number">7</span>.<span class="number">21</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz</span><br></pre></td></tr></table></figure>
<p>创建目录</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mkdir</span> /usr/local/&#123;mysql-<span class="number">5</span>.<span class="number">5</span>.<span class="number">59</span>,mysql-<span class="number">5</span>.<span class="number">6</span>.<span class="number">39</span>,mysql-<span class="number">5</span>.<span class="number">7</span>.<span class="number">21</span>&#125;</span><br></pre></td></tr></table></figure>
<p>解压</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf mysql-<span class="number">5</span>.<span class="number">5</span>.<span class="number">59</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz -C /usr/local/mysql-<span class="number">5</span>.<span class="number">5</span>.<span class="number">59</span>/</span><br><span class="line"><span class="attribute">tar</span> -zxvf mysql-<span class="number">5</span>.<span class="number">6</span>.<span class="number">39</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz -C /usr/local/mysql-<span class="number">5</span>.<span class="number">6</span>.<span class="number">39</span>/</span><br><span class="line"><span class="attribute">tar</span> -zxvf mysql-<span class="number">5</span>.<span class="number">7</span>.<span class="number">21</span>-linux-glibc<span class="number">2</span>.<span class="number">12</span>-x<span class="number">86</span>_<span class="number">64</span>.tar.gz -C /usr/local/mysql-<span class="number">5</span>.<span class="number">7</span>.<span class="number">21</span>/</span><br></pre></td></tr></table></figure>
<p>设置环境变量</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">zst_ps1()</span><br><span class="line">&#123;</span><br><span class="line">  Date=$(date +<span class="variable">%F)</span></span><br><span class="line"><span class="variable">  Time=$(date +%</span>H:<span class="variable">%M:%</span>S)</span><br><span class="line"></span><br><span class="line">  PS1=&quot;<span class="symbol">\\</span>n<span class="symbol">\[</span><span class="symbol">\e</span>[1;37m[<span class="symbol">\e</span>[m<span class="symbol">\]</span><span class="symbol">\[</span><span class="symbol">\e</span>[1;33m<span class="symbol">\u</span><span class="symbol">\e</span>[m<span class="symbol">\]</span><span class="symbol">\[</span><span class="symbol">\e</span>[1;33m@<span class="symbol">\h</span><span class="symbol">\e</span>[m<span class="symbol">\]</span><span class="symbol">\[</span><span class="symbol">\e</span>[1;35m <span class="keyword">$Time \e[m\]\e[1;36m\w\e[m\e[1;37m]\e[m\n\\$&quot;</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">PROMPT_COMMAND=zst_ps1</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">export PATH=/usr/local/mysql/bin:$PATH</span></span><br><span class="line"><span class="keyword">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/mysql/lib</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-MySQL-5.5.X升级至5.7.21遇到的坑(一)"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/10/MySQL-5.5.X%E5%8D%87%E7%BA%A7%E8%87%B35.7.21%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91(%E4%B8%80)/">MySQL 5.5.X升级至5.7.21遇到的坑(一)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/02/10/MySQL-5.5.X%E5%8D%87%E7%BA%A7%E8%87%B35.7.21%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91(%E4%B8%80)/" class="article-date">
	  <time datetime="2018-02-10T12:23:00.000Z" itemprop="datePublished">2018-02-10</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL-5-5-X升级至5-7-21遇到的坑-一"><a href="#MySQL-5-5-X升级至5-7-21遇到的坑-一" class="headerlink" title="MySQL 5.5.X升级至5.7.21遇到的坑(一)"></a>MySQL 5.5.X升级至5.7.21遇到的坑(一)</h1><h2 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h2><p>将一个测试环境的5.5.x升级到5.7.21后,打算将5.7.21作为从库,开始同步主库数据(binlog_format=statement),结果刚一start slave就报错<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Coordinator stopped because there were error(s) in the worker(s). The most recent failure being: Worker 1 failed executing transaction &#x27;ANONYMOUS&#x27; at master log mysql-bin.000004, end_log_pos 812. See error log<span class="built_in"> and/or </span>performance_schema.replication_applier_status_by_worker table for more details about this failure<span class="built_in"> or </span>others,<span class="built_in"> if </span>any.</span><br></pre></td></tr></table></figure><br>查看error log<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2018-02-10T19:52:52.347979+08:00 3 [Warning] Slave I/O for channel &#x27;&#x27;: Notifying master by <span class="keyword">SET</span> @master_binlog_checksum= @@global.binlog_checksum <span class="keyword">failed</span> <span class="keyword">with</span> er</span><br><span class="line">ror: <span class="literal">Unknown</span> <span class="keyword">system</span> <span class="keyword">variable</span> <span class="string">&#x27;binlog_checksum&#x27;</span>, Error_code: <span class="number">1193</span></span><br><span class="line"><span class="number">2018</span><span class="number">-02</span><span class="number">-10</span>T19:<span class="number">52</span>:<span class="number">52.348080</span>+<span class="number">08</span>:<span class="number">00</span> <span class="number">3</span> [<span class="keyword">Warning</span>] <span class="keyword">Slave</span> I/O <span class="keyword">for</span> channel <span class="string">&#x27;&#x27;</span>: <span class="literal">Unknown</span> <span class="keyword">system</span> <span class="keyword">variable</span> <span class="string">&#x27;SERVER_UUID&#x27;</span> <span class="keyword">on</span> master. A probable cause <span class="keyword">is</span> that the <span class="keyword">variable</span> i</span><br><span class="line">s <span class="keyword">not</span> supported <span class="keyword">on</span> the <span class="keyword">master</span> (<span class="keyword">version</span>: <span class="number">5.5</span><span class="number">.59</span>-<span class="keyword">log</span>), even though it <span class="keyword">is</span> <span class="keyword">on</span> the <span class="keyword">slave</span> (<span class="keyword">version</span>: <span class="number">5.7</span><span class="number">.21</span>-<span class="keyword">log</span>), Error_code: <span class="number">1193</span></span><br><span class="line"><span class="number">2018</span><span class="number">-02</span><span class="number">-10</span>T19:<span class="number">52</span>:<span class="number">52.445947</span>+<span class="number">08</span>:<span class="number">00</span> <span class="number">5</span> [<span class="keyword">ERROR</span>] <span class="keyword">Slave</span> <span class="keyword">SQL</span> <span class="keyword">for</span> channel <span class="string">&#x27;&#x27;</span>: Worker <span class="number">1</span> <span class="keyword">failed</span> executing <span class="keyword">transaction</span> <span class="string">&#x27;ANONYMOUS&#x27;</span> <span class="keyword">at</span> <span class="keyword">master</span> <span class="keyword">log</span> , end_log_pos <span class="number">2651</span>; Error </span><br><span class="line">&#x27;You have an error in your SQL syntax; <span class="keyword">check</span> the <span class="keyword">manual</span> that corresponds <span class="keyword">to</span> your MySQL <span class="keyword">server</span> <span class="keyword">version</span> <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> <span class="keyword">use</span> near <span class="string">&#x27;GET, POST, FILE, CLASS,</span></span><br><span class="line"><span class="string"> METHOD ) VALUES ( &#x27;</span>maokaixin<span class="string">&#x27;, 1518159802, 3395959414, &#x27;&#x27; at line 1&#x27;</span> <span class="keyword">on</span> query. <span class="keyword">Default</span> <span class="keyword">database</span>: <span class="string">&#x27;fandb&#x27;</span>. <span class="keyword">Query</span>: <span class="string">&#x27;INSERT INTO postlog ( USERNAME, TIME, IP, GE</span></span><br><span class="line"><span class="string">T, POST, FILE, CLASS, METHOD ) VALUES ( &#x27;</span>maokaixin<span class="string">&#x27;, 1518159802, 3395959414, &#x27;</span>gameid:<span class="number">0</span>;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;api&#x27;, &#x27;ajaxGetServers&#x27; )&#x27;, Error_code: 1064</span><br><span class="line">2018-02-10T19:52:52.446217+08:00 4 [Warning] Slave SQL for channel &#x27;&#x27;: ... The slave coordinator and worker threads are stopped, possibly leaving data in incon</span><br><span class="line">sistent state. A restart should <span class="keyword">restore</span> consistency automatically, although <span class="keyword">using</span> non-<span class="keyword">transactional</span> <span class="keyword">storage</span> <span class="keyword">for</span> <span class="keyword">data</span> <span class="keyword">or</span> info <span class="keyword">tables</span> <span class="keyword">or</span> <span class="keyword">DDL</span> queries could <span class="keyword">lead</span> t</span><br><span class="line">o problems. <span class="keyword">In</span> such cases you have <span class="keyword">to</span> examine your <span class="keyword">data</span> (see documentation <span class="keyword">for</span> details). Error_code: <span class="number">1756</span></span><br><span class="line"><span class="number">2018</span><span class="number">-02</span><span class="number">-10</span>T19:<span class="number">52</span>:<span class="number">52.446235</span>+<span class="number">08</span>:<span class="number">00</span> <span class="number">4</span> [Note] <span class="keyword">Slave</span> <span class="keyword">SQL</span> <span class="keyword">thread</span> <span class="keyword">for</span> channel <span class="string">&#x27;&#x27;</span> exiting, <span class="keyword">replication</span> stopped <span class="keyword">in</span> <span class="keyword">log</span> <span class="string">&#x27;mysql-bin.000003&#x27;</span> <span class="keyword">at</span> <span class="keyword">position</span> <span class="number">2313</span></span><br><span class="line"><span class="number">2018</span><span class="number">-02</span><span class="number">-10</span>T19:<span class="number">53</span>:<span class="number">15.708058</span>+<span class="number">08</span>:<span class="number">00</span> <span class="number">7</span> [Note] <span class="keyword">Slave</span> <span class="keyword">SQL</span> <span class="keyword">thread</span> <span class="keyword">for</span> channel <span class="string">&#x27;&#x27;</span> <span class="keyword">initialized</span>, <span class="keyword">starting</span> <span class="keyword">replication</span> <span class="keyword">in</span> <span class="keyword">log</span> <span class="string">&#x27;mysql-bin.000003&#x27;</span> <span class="keyword">at</span> <span class="keyword">position</span> <span class="number">2313</span>, relay l</span><br><span class="line">og <span class="string">&#x27;./mysql-relay.000009&#x27;</span> <span class="keyword">position</span>: <span class="number">304</span></span><br></pre></td></tr></table></figure></p>
<h2 id="找出原因"><a href="#找出原因" class="headerlink" title="找出原因"></a>找出原因</h2><p>头两个<code>Warning</code>是由于主库没有binlog_checksum参数，也没有SERVER_UUID参数(看来从库开始同步时要先去主库查询这两个参数)<br>接着的<code>ERROR</code>报的错误竟然是<code>error in your SQL syntax</code>语法错误.</p>
<p>解析binlog后查到SQL语句为<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT <span class="keyword">INTO</span> postlog ( USERNAME, TIME, IP, GET, POST, FILE, <span class="keyword">CLASS</span>, <span class="function"><span class="keyword">METHOD</span> ) <span class="title">VALUES</span> <span class="params">( <span class="string">&#x27;maokaixin&#x27;</span>, 1518159802, 3395959414, <span class="string">&#x27;gameid:0;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;api&#x27;</span>, <span class="string">&#x27;ajaxGetServers&#x27;</span> )</span>;</span></span><br></pre></td></tr></table></figure><br>我依次在5.5和5.7的环境执行这个SQL发现该SQL在5.5可以正常执行，而在5.7执行就会报错语法错误<br>于是一点一点分析这个SQL哪有问题，说实话肉眼真没看出来<br>只好在5.7一点一点执行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> postlog ( USERNAME, <span class="built_in">TIME</span>, IP) <span class="keyword">VALUES</span> ( <span class="string">&#x27;maokaixin&#x27;</span>, <span class="number">1518159802</span>, <span class="number">3395959414</span>);</span><br></pre></td></tr></table></figure><br>没问题可以执行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> postlog ( USERNAME, <span class="built_in">TIME</span>, IP, <span class="keyword">GET</span>) <span class="keyword">VALUES</span> ( <span class="string">&#x27;maokaixin&#x27;</span>, <span class="number">1518159802</span>, <span class="number">3395959414</span>, <span class="string">&#x27;gameid:0;&#x27;</span>);</span><br></pre></td></tr></table></figure><br>报错了！,那显然就是<code>GET</code>有问题。 怀疑是保留字？</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-python2 yum module is needed for this  module"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
    <div class="article-meta">
      
	<a href="/2018/02/09/python2%20yum%20module%20is%20needed%20for%20this%20%20module/" class="article-date">
	  <time datetime="2018-02-09T06:00:17.000Z" itemprop="datePublished">2018-02-09</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>pyenv装的2.7.14 无法用ansible yum.(其实不是pyenv的原因,自己编译安装的2.7.14也不行)</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#ansible OA* -m yum -a<span class="string">&quot;name=mutt state=present&quot;</span> </span><br><span class="line">OA_P | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="keyword">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;python2 yum module is needed for this  module&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">OA_S | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="keyword">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;python2 yum module is needed for this  module&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#ansible OA* -m shell -a <span class="string">&quot;which python pip&quot;</span></span><br><span class="line">OA_P | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">2.7</span>.<span class="number">14</span><span class="regexp">/bin/</span>python</span><br><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">2.7</span>.<span class="number">14</span><span class="regexp">/bin/</span>pip</span><br><span class="line">OA_S | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">2.7</span>.<span class="number">14</span><span class="regexp">/bin/</span>python</span><br><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">2.7</span>.<span class="number">14</span><span class="regexp">/bin/</span>pip</span><br><span class="line"></span><br><span class="line">#vi <span class="regexp">/etc/</span>ansible<span class="regexp">/hosts/</span>oa </span><br><span class="line">[OA]</span><br><span class="line">OA_P ansible_connection=local</span><br><span class="line">OA_S ansible_ssh_host=<span class="number">172.16</span>.<span class="number">200.209</span> </span><br><span class="line">[OA:vars]</span><br><span class="line">ansible_python_interpreter=<span class="regexp">/root/</span>.pyenv<span class="regexp">/shims/</span>python</span><br></pre></td></tr></table></figure>
<p>使用系统默认的python作为解释器可以使用yum模块<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@OA_P <span class="number">13</span>:<span class="number">04</span>:<span class="number">15</span> /etc/ansible/roles]</span><br><span class="line"><span class="comment">#ansible OA* -m yum -a&quot;name=mutt state=present&quot; </span></span><br><span class="line">OA_P | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;python2 bindings for rpm are needed for this module. python2 yum module is needed for this  module&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">OA_S | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;python2 bindings for rpm are needed for this module. python2 yum module is needed for this  module&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">^C</span><br><span class="line">[root@OA_P <span class="number">13</span>:<span class="number">04</span>:<span class="number">28</span> /etc/ansible/roles]</span><br><span class="line"><span class="comment">#ansible OA* -m yum -a&quot;name=mutt state=present&quot; -e &quot;ansible_python_interpreter=/usr/bin/python&quot;</span></span><br><span class="line">OA_S | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: <span class="number">0</span>, </span><br><span class="line">    <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;5:mutt-1.5.20-8.20091214hg736b6a.el6.x86_64 providing mutt is already installed&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">OA_P | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;The following packages have pending transactions: mutt-x86_64&quot;</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: <span class="number">125</span>, </span><br><span class="line">    <span class="string">&quot;results&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这是因为2.6可以import yum而2.7不行<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python</span></span><br><span class="line">Python 2.7.14 (default, Dec 15 2017, 23:08:56) </span><br><span class="line">[GCC 4.4.7 20120313 (Red Hat 4.4.7-18)] on linux2</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import yum</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ImportError: <span class="literal">No</span> module named yum</span><br><span class="line"></span><br><span class="line"><span class="comment">#python2.6</span></span><br><span class="line">Python 2.6.6 (r266:84292, Aug 18 2016, 15:13:37) </span><br><span class="line">[GCC 4.4.7 20120313 (Red Hat 4.4.7-17)] on linux2</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import yum</span><br></pre></td></tr></table></figure></p>
<p>目前我的解决方法是, 在yum之前先set facts, 之后在set回来<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">set_fact:</span></span><br><span class="line">    <span class="attr">ansible_python_default_interpreter:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_python_interpreter &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">ansible_python_interpreter:</span>  <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装依赖包</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">  <span class="attr">with_items:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">line:</span> <span class="string">&#x27;openssl&#x27;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">line:</span> <span class="string">&#x27;openssl-devel&#x27;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">line:</span> <span class="string">&#x27;mutt&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">set_fact:</span></span><br><span class="line">    <span class="attr">ansible_python_interpreter:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_python_default_interpreter &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>参考</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/openshift/openshift-ansible/issues/855">https://github.com/openshift/openshift-ansible/issues/855</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29711514/no-module-named-yum-error-with-python2-7-when-using-ansible-on-fedora/36138921#36138921">https://stackoverflow.com/questions/29711514/no-module-named-yum-error-with-python2-7-when-using-ansible-on-fedora/36138921#36138921</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-CONFIG REWRITE命令"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
    <div class="article-meta">
      
	<a href="/2018/01/19/CONFIG%20REWRITE%E5%91%BD%E4%BB%A4/" class="article-date">
	  <time datetime="2018-01-19T03:09:11.000Z" itemprop="datePublished">2018-01-19</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CONFIG-REWRITE"><a href="#CONFIG-REWRITE" class="headerlink" title="CONFIG REWRITE"></a>CONFIG REWRITE</h1><blockquote>
<p>Available since 2.8.0.</p>
</blockquote>
<p>CONFIG REWRITE命令用于重写redis server启动时使用的配置文件,以最小的变动反映当前server的实际配置,当前的实际配置可能会由于CONFIG SET的使用而与启动时的配置文件不同.</p>
<blockquote>
<p>类似 scope=spfile</p>
</blockquote>
<p>重写以非常保守的方式执行:</p>
<ul>
<li>尽可能保留原始redis.conf的注释和整体结构.</li>
<li>如果一个选项已经存在于旧的redis.conf文件中,它将被原地更新.</li>
<li>如果某个选项尚不存在,但设置为其默认值,则不会由重写过程添加.</li>
<li>如果某个选项尚不存在,但它被设置为非默认值,则会将其附加到文件末尾.</li>
<li>Non used lines are blanked. For instance if you used to have multiple save directives, but the current configuration has fewer or none as you disabled RDB persistence, all the lines will be blanked.<blockquote>
<p>未使用的行将被删除.例如,如果您曾经设置多个save,但是后来却通过config set只设置了更少的或者config set save ‘’,那么所有的未使用save将被删除</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -p 6379<span class="built_in"> config </span><span class="builtin-name">get</span> save</span><br><span class="line">1) <span class="string">&quot;save&quot;</span></span><br><span class="line">2) <span class="string">&quot;&quot;</span></span><br><span class="line">[root@cn_mu_binlog_backup ~]# cat /usr/local/redis/etc/6379_redis.conf|grep save</span><br><span class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   <span class="doctag">Note:</span> you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="comment">#   save &quot;&quot;</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">重写</span><br><span class="line">[root@cn_mu_binlog_backup ~]# redis-cli -p 6379<span class="built_in"> config </span>rewrite</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@cn_mu_binlog_backup ~]# cat /usr/local/redis/etc/6379_redis.conf|grep save</span><br><span class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   <span class="doctag">Note:</span> you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="comment">#   save &quot;&quot;</span></span><br><span class="line"><span class="comment"># (at least one save point) and the latest background save failed.</span></span><br><span class="line">stop-writes-on-bgsave-<span class="builtin-name">error</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># If you want to save some CPU in the saving child set it to &#x27;no&#x27; but</span></span><br><span class="line"><span class="comment"># algorithms (in order to save memory), so you can tune it for speed or</span></span><br><span class="line"><span class="comment"># the configured save points).</span></span><br><span class="line"><span class="comment"># saving process (a background save or AOF log background rewriting) is</span></span><br><span class="line"><span class="comment"># Lists are also encoded in a special way to save a lot of space.</span></span><br><span class="line"><span class="comment"># order to save a lot of space. This encoding is only used when the length and</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>如果由于某种原因原来的配置文件不再存在,CONFIG REWRITE也可以重写配置文件. 但是,如果服务器启动时没有配置文件,CONFIG REWRITE将只返回一个错误.</p>
<h2 id="原子重写过程"><a href="#原子重写过程" class="headerlink" title="原子重写过程"></a>原子重写过程</h2><p>In order to make sure the redis.conf file is always consistent, that is, on errors or crashes you always end with the old file, or the new one, the rewrite is performed with a single write(2) call that has enough content to be at least as big as the old file. Sometimes additional padding in the form of comments is added in order to make sure the resulting file is big enough, and later the file gets truncated to remove the padding at the end.</p>
<blockquote>
<p>为了确保redis.conf文件始终保持一致,即在出现错误或崩溃时总是以旧文件或新文件结束,重写将使用具有足够内容的单次写入(2)调用来执行 至少与旧文件一样大. 有时会添加注释形式的其他填充以确保生成的文件足够大,然后文件被截断以删除最后的填充.</p>
</blockquote>
<h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p><a target="_blank" rel="noopener" href="https://redis.io/topics/protocol#simple-string-reply">Simple string reply</a>: OK 当配置被正确重写. 否则,返回错误</p>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/9/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/11/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2021 Fan() All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>



  
<script src="/js/home.js"></script>











	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Fan()
          </div>
          <div class="panel-body">
            Copyright © 2021 大范 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>