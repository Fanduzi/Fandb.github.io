<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Fan()</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Fan()">
<meta property="og:url" content="http://fuxkdb.com/page/9/index.html">
<meta property="og:site_name" content="Fan()">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="大范">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Fan()" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpeg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpeg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 5.1.1"></head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="/css/images/1.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="/css/images/2.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="/css/images/3.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="/css/images/4.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="/css/images/5.jpeg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">Fan()</a></h1>
            <h3></h3>
            <h5>大范</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-MySQL Group Replication- understanding Flow Control[译文]"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/08/26/MySQL%20Group%20Replication-%20understanding%20Flow%20Control%5B%E8%AF%91%E6%96%87%5D/">MySQL Group Replication- understanding Flow Control[译文]</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/08/26/MySQL%20Group%20Replication-%20understanding%20Flow%20Control%5B%E8%AF%91%E6%96%87%5D/" class="article-date">
	  <time datetime="2018-08-26T15:05:00.000Z" itemprop="datePublished">2018-08-26</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL-Group-Replication-understanding-Flow-Control"><a href="#MySQL-Group-Replication-understanding-Flow-Control" class="headerlink" title="MySQL Group Replication: understanding Flow Control"></a><a target="_blank" rel="noopener" href="https://lefred.be/content/mysql-group-replication-understanding-flow-control/">MySQL Group Replication: understanding Flow Control</a></h1><p>使用MySQL Group Replication时，某些成员可能落后于该组。 由于负载，硬件限制等原因…这种滞后可能会导致不能保持良好的性能认证行为和不能尽可能降低认证失败次数.应用队列(applying queue)越大, 与尚未应用的事务发生冲突的风险就越大（这在Multi-Primary Groups上是有问题的）。</p>
<p>Galera用户已经熟悉这个概念(译注: 指流控的概念). MySQL Group Replication的实现与Galera有两个主要不同点:</p>
<ul>
<li><p>the Group is never totally stalled(译注: Group不会彻底停止接收写请求)</p>
</li>
<li><p>the node having issues doesn’t send flow control messages to the rest of the group asking for slowing down(译注: 短板节点不会向Group的其他节点发送flow control消息来要求集群减速)</p>
</li>
</ul>
<p>实际上，该组的每个成员都会向其他成员发送有关其队列（applier queue and certification queue）的一些统计信息。 然后，如果每个节点意识到一个节点达到了其中一个队列的阈值，则决定是否减速：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">group_replication_flow_control_applier_threshold (<span class="keyword">default</span> <span class="keyword">is</span> <span class="number">25000</span>)</span><br><span class="line"></span><br><span class="line">group_replication_flow_control_certifier_threshold (<span class="keyword">default</span> <span class="keyword">is</span> <span class="number">25000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因此，如果在节点上将<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/group-replication-options.html#sysvar_group_replication_flow_control_mode">group_replication_flow_control_mode</a>设置为<code>QUOTA</code>，并且看到该集群的其他成员之一落后（达到阈值），则会将写入操作限制为最小配额。 此配额是根据最后一秒中应用的transactions数计算的，然后通过减去上一个周期的“over the quota”消息来减少。 </p>
<blockquote>
<p>and then it is reduced below that by subtracting the “over the quota” messages from the last period.</p>
</blockquote>
<p>这意味着与Galera相反，Galera的(flow control)阈值是有短板节点决定的，对于我们在MySQL组复制中，编写事务的节点(译注: 写节点)检查其阈值流量控制值并将它们与来自其他节点的统计数据进行比较以决定是否进行flow control。</p>
<p>您可以在Vitor的文章<a target="_blank" rel="noopener" href="http://mysqlhighavailability.com/zooming-in-on-group-replication-performance/">Zooming-in on Group Replication Performance</a>一文中找到有关组复制流控制的更多信息</p>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-如何确定Single-Primary模式下的MGR主节点"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/08/25/%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9ASingle-Primary%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84MGR%E4%B8%BB%E8%8A%82%E7%82%B9/">如何确定Single-Primary模式下的MGR主节点</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/08/25/%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9ASingle-Primary%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84MGR%E4%B8%BB%E8%8A%82%E7%82%B9/" class="article-date">
	  <time datetime="2018-08-25T15:00:00.000Z" itemprop="datePublished">2018-08-25</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="如何确定Single-Primary模式下的MGR主节点-文档-ID-2214438-1"><a href="#如何确定Single-Primary模式下的MGR主节点-文档-ID-2214438-1" class="headerlink" title="如何确定Single-Primary模式下的MGR主节点(文档 ID 2214438.1)"></a><a target="_blank" rel="noopener" href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=27962468209367&amp;parent=DOCUMENT&amp;sourceId=2215424.1&amp;id=2214438.1&amp;_afrWindowMode=0&amp;_adf.ctrl-state=s3zl3ux6s_200">如何确定Single-Primary模式下的MGR主节点(文档 ID 2214438.1)</a></h1><h2 id="MySQL-5-7"><a href="#MySQL-5-7" class="headerlink" title="MySQL 5.7"></a>MySQL 5.7</h2><p>可以通过global status <code>group_replication_primary_member</code>确定<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT VARIABLE<span class="emphasis">_VALUE</span></span><br><span class="line"><span class="emphasis">         FROM performance_</span>schema.global<span class="emphasis">_status</span></span><br><span class="line"><span class="emphasis">        WHERE VARIABLE_</span>NAME = <span class="emphasis">&#x27;group_replication_primary_member&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------------------------+</span></span><br><span class="line">| VARIABLE<span class="emphasis">_VALUE                       |</span></span><br><span class="line"><span class="emphasis">+--------------------------------------+</span></span><br><span class="line"><span class="emphasis">| 9d7f8c28-c02c-11e6-9829-08002715584a |</span></span><br><span class="line"><span class="emphasis">+--------------------------------------+</span></span><br><span class="line"><span class="emphasis">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如果是Multi-Primary默认则结果为空</p>
</blockquote>
<p>可以结合<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/en/replication-group-members-table.html">performance_schema.replication_group_members</a>表 获取主机名和端口信息:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line"><span class="code">    MEMBER_HOST, MEMBER_PORT</span></span><br><span class="line">FROM</span><br><span class="line"><span class="code">    performance_schema.replication_group_members</span></span><br><span class="line">WHERE</span><br><span class="line"><span class="code">    MEMBER_ID = (SELECT </span></span><br><span class="line"><span class="code">            VARIABLE_VALUE</span></span><br><span class="line"><span class="code">        FROM</span></span><br><span class="line"><span class="code">            performance_schema.global_status</span></span><br><span class="line"><span class="code">        WHERE</span></span><br><span class="line"><span class="code">            VARIABLE_NAME = &#x27;group_replication_primary_member&#x27;);</span></span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">| MEMBER<span class="emphasis">_HOST | MEMBER_</span>PORT |</span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">| ol7         |        3306 |</span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><br>或者获取全部成员信息:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line"><span class="code">    MEMBER_ID,</span></span><br><span class="line"><span class="code">    MEMBER_HOST,</span></span><br><span class="line"><span class="code">    MEMBER_PORT,</span></span><br><span class="line"><span class="code">    MEMBER_STATE,</span></span><br><span class="line"><span class="code">    IF(global_status.VARIABLE_NAME IS NOT NULL,</span></span><br><span class="line"><span class="code">        &#x27;PRIMARY&#x27;,</span></span><br><span class="line"><span class="code">        &#x27;SECONDARY&#x27;) AS MEMBER_ROLE</span></span><br><span class="line">FROM</span><br><span class="line"><span class="code">    performance_schema.replication_group_members</span></span><br><span class="line"><span class="code">        LEFT JOIN</span></span><br><span class="line"><span class="code">    performance_schema.global_status ON global_status.VARIABLE_NAME = &#x27;group_replication_primary_member&#x27;</span></span><br><span class="line"><span class="code">        AND global_status.VARIABLE_VALUE = replication_group_members.MEMBER_ID;</span></span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------<span class="code">+-------------+</span>--------------<span class="code">+-------------+</span></span><br><span class="line">| MEMBER<span class="emphasis">_ID                            | MEMBER_</span>HOST | MEMBER<span class="emphasis">_PORT | MEMBER_</span>STATE | MEMBER<span class="emphasis">_ROLE |</span></span><br><span class="line"><span class="emphasis">+--------------------------------------+-------------+-------------+--------------+-------------+</span></span><br><span class="line"><span class="emphasis">| 9d7f8c28-c02c-11e6-9829-08002715584a | ol7         |        3306 | ONLINE       | PRIMARY     |</span></span><br><span class="line"><span class="emphasis">| f2bbb11d-c0c4-11e6-98ec-08002715584a | ol7         |        3308 | ONLINE       | SECONDARY   |</span></span><br><span class="line"><span class="emphasis">| f5bb7d78-c02c-11e6-9c56-08002715584a | ol7         |        3307 | ONLINE       | SECONDARY   |</span></span><br><span class="line"><span class="emphasis">+--------------------------------------+-------------+-------------+--------------+-------------+</span></span><br><span class="line"><span class="emphasis">3 rows in set (0.00 sec)</span></span><br></pre></td></tr></table></figure></p>
<h2 id="MySQL-8-0-2-and-Later"><a href="#MySQL-8-0-2-and-Later" class="headerlink" title="MySQL 8.0.2 and Later"></a>MySQL 8.0.2 and Later</h2><p>MySQL 8.0.2开始, <a target="_blank" rel="noopener" href="http://mysqlhighavailability.com/group-replication-extending-group-replication-performance_schema-tables/">Performance Schema被扩展</a><br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT MEMBER<span class="emphasis">_HOST, MEMBER_</span>PORT</span><br><span class="line"><span class="code">         FROM performance_schema.replication_group_members</span></span><br><span class="line"><span class="code">        WHERE MEMBER_ROLE = &#x27;PRIMARY&#x27;;</span></span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">| MEMBER<span class="emphasis">_HOST | MEMBER_</span>PORT |</span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">| ol7         |        3306 |</span><br><span class="line"><span class="code">+-------------+</span>-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><br>或者获取全部成员信息:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT MEMBER<span class="emphasis">_ID, MEMBER_</span>HOST, MEMBER<span class="emphasis">_PORT, MEMBER_</span>STATE, MEMBER<span class="emphasis">_ROLE, MEMBER_</span>VERSION</span><br><span class="line"><span class="code">         FROM performance_schema.replication_group_members;</span></span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------<span class="code">+-------------+</span>--------------<span class="code">+-------------+</span>----------------+</span><br><span class="line">| MEMBER<span class="emphasis">_ID                            | MEMBER_</span>HOST | MEMBER<span class="emphasis">_PORT | MEMBER_</span>STATE | MEMBER<span class="emphasis">_ROLE | MEMBER_</span>VERSION |</span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------<span class="code">+-------------+</span>--------------<span class="code">+-------------+</span>----------------+</span><br><span class="line">| 33565eab-731f-11e7-8e94-08002715584a | ol7         |        3307 | ONLINE       | SECONDARY   | 8.0.2          |</span><br><span class="line">| 86034b0a-731f-11e7-9f33-08002715584a | ol7         |        3308 | ONLINE       | SECONDARY   | 8.0.2          |</span><br><span class="line">| a45d3804-731e-11e7-9003-08002715584a | ol7         |        3306 | ONLINE       | PRIMARY     | 8.0.2          |</span><br><span class="line"><span class="code">+--------------------------------------+</span>-------------<span class="code">+-------------+</span>--------------<span class="code">+-------------+</span>----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>References<br><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/en/group-replication-find-primary.html">https://dev.mysql.com/doc/refman/en/group-replication-find-primary.html</a><br><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/en/group-replication-options.html#sysvar_group_replication_single_primary_mode">https://dev.mysql.com/doc/refman/en/group-replication-options.html#sysvar_group_replication_single_primary_mode</a><br><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/en/replication-group-members-table.html">https://dev.mysql.com/doc/refman/en/replication-group-members-table.html</a><br><a target="_blank" rel="noopener" href="http://mysqlhighavailability.com/group-replication-extending-group-replication-performance_schema-tables/">http://mysqlhighavailability.com/group-replication-extending-group-replication-performance_schema-tables/</a><br><a target="_blank" rel="noopener" href="http://lefred.be/content/mysql-group-replication-who-is-the-primary-master-updated/">http://lefred.be/content/mysql-group-replication-who-is-the-primary-master-updated/</a> </p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-执行sql文件限制频率避免流控"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/08/20/%E6%89%A7%E8%A1%8Csql%E6%96%87%E4%BB%B6%E9%99%90%E5%88%B6%E9%A2%91%E7%8E%87%E9%81%BF%E5%85%8D%E6%B5%81%E6%8E%A7/">执行sql文件限制频率避免流控</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/08/20/%E6%89%A7%E8%A1%8Csql%E6%96%87%E4%BB%B6%E9%99%90%E5%88%B6%E9%A2%91%E7%8E%87%E9%81%BF%E5%85%8D%E6%B5%81%E6%8E%A7/" class="article-date">
	  <time datetime="2018-08-20T15:04:00.000Z" itemprop="datePublished">2018-08-20</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="避免流控"><a href="#避免流控" class="headerlink" title="避免流控"></a>避免流控</h2><p>对于pxc, 为了避免流控, 可以在导入.sql文件时, 先对文件做处理<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> &#x27;<span class="number">1</span>;NR%<span class="number">1000</span>==<span class="number">0</span>&#123;print <span class="string">&quot;select sleep(1);&quot;</span>&#125;&#x27; xxx.sql &gt; xxx_dba.sql</span><br></pre></td></tr></table></figure><br>上面的命令每1000行增加一行<code>select sleep(1);</code>, 这样执行频率是1k/s</p>
<p>对于mysqldump产生的sql文件, 则需要在导出是指定<br><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --<span class="meta">skip</span>-extended-<span class="meta">insert</span></span><br></pre></td></tr></table></figure><br>每行一个insert语句, 之后再使用awk处理</p>
<p>使用pt-fifo-split</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">FLAT_FILE</span>=<span class="string">&quot;/tmp/big_file.txt&quot;</span></span><br><span class="line"><span class="attribute">FIFO_PATH</span>=<span class="string">&quot;<span class="variable">$&#123;FLAT_FILE&#125;</span>.fifo&quot;</span></span><br><span class="line"><span class="attribute">LOAD_FILE</span>=<span class="string">&quot;<span class="variable">$&#123;FLAT_FILE&#125;</span>.load&quot;</span></span><br><span class="line"><span class="attribute">CHUNK_SIZE</span>=1000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Split the file</span></span><br><span class="line">pt-fifo-split --force --lines <span class="variable">$&#123;CHUNK_SIZE&#125;</span> <span class="variable">$&#123;FLAT_FILE&#125;</span> --fifo <span class="variable">$&#123;FIFO_PATH&#125;</span> &amp;</span><br><span class="line"><span class="comment"># Sleep 10 seconds to assure $&#123;FIFO_PATH&#125; exists before entering loop</span></span><br><span class="line">sleep 10</span><br><span class="line"><span class="keyword">while</span> [ -e <span class="variable">$&#123;FIFO_PATH&#125;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  # Write chunk <span class="keyword">to</span> disk</span><br><span class="line">  cat <span class="variable">$&#123;FIFO_PATH&#125;</span> &gt; <span class="variable">$&#123;LOAD_FILE&#125;</span></span><br><span class="line">  # Load chunk into table</span><br><span class="line">  mysql <span class="attribute">--database</span>=test \</span><br><span class="line">   --show-warnings \</span><br><span class="line">   -vv &lt; <span class="variable">$&#123;LOAD_FILE&#125;</span></span><br><span class="line">  sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-Write-set Cache(GCache)"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/06/02/Write-set%20Cache(GCache)/">Write-set Cache(GCache)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/06/02/Write-set%20Cache(GCache)/" class="article-date">
	  <time datetime="2018-06-02T05:23:00.000Z" itemprop="datePublished">2018-06-02</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Write-set-Cache-GCache"><a href="#Write-set-Cache-GCache" class="headerlink" title="Write-set Cache(GCache)"></a>Write-set Cache(GCache)</h3><p>Galear Cluster将write-sets存储在一个称为<a target="_blank" rel="noopener" href="http://galeracluster.com/documentation-webpages/glossary.html#term-write-set-cache">Write-set Cache</a>(或称为GCache)的特殊的cache中. GCache cache is a memory allocator for write-sets.主要目的是为了最大限度地减少RAM上的<a target="_blank" rel="noopener" href="http://galeracluster.com/documentation-webpages/glossary.html#term-write-set">write-set</a>footprint. Galera集群通过将卸载写入集存储到磁盘来改善此问题.</p>
<p>GCache采用三种类型的存储：</p>
<ul>
<li><p><strong>Permanent In-Memory Store </strong>Here write-sets allocate using the default memory allocator for the operating system. This is useful in systems that have spare RAM. The store has a hard size limit.</p>
<p>By default it is disabled.</p>
<p>这个就是说可以用操作系统的内存空间, 对于有空闲内存的系统比较合适. 这个空间大小有一个硬性的限制, 貌似是这个参数gcache.mem_size=0[^1]</p>
<p>默认不使用内存.</p>
</li>
<li><p><strong>Permanent Ring-Buffer File</strong> Here write-sets pre-allocate to disk during cache initialization. This is intended as the main write-set store.</p>
<p>这一个块循环使用的区域, 是写到磁盘上的 , 貌似是这个参数gcache.size = 128M<a href="Galera复制的事务缓存大小。这定义了用作IST源的galera.cache文件的大小。此变量的值越大，重新加入节点将获得IST而不是SST的机会就越好。">^2</a></p>
</li>
<li><p><strong>On-Demand Page Store</strong> 这里写集根据需要在运行时分配给内存映射的页面文件。   默认情况下，其大小为128Mb(gcache.page_size[^3])，但如果需要存储更大的写入集，则可能会更大。页面存储的大小受可用磁盘空间的限制。默认情况下，Galera Cluster会在不使用时删除页面文件，但您可以对要保留的页面文件的总大小设置限制。 </p>
<p>When all other stores are disabled, at least one page file remains present on disk.</p>
</li>
</ul>
<p>Galera集群使用分配算法，尝试按上述顺序存储写入集。也就是说，它首先尝试使用永久性内存存储。如果写入集没有足够的空间，它将尝试存储到永久环形缓冲区文件。页面存储总是成功，除非写入集大于可用磁盘空间。</p>
<blockquote>
<p>Galera Cluster uses an allocation algorithm that attempts to store write-sets in the above order. That is, first it attempts to use permanent in-memory store. If there is not enough space for the write-set, it attempts to store to the permanent ring-buffer file. The page store always succeeds, unless the write-set is larger than the available disk space.</p>
</blockquote>
<p>默认情况下，写集缓存分配进程工作目录中的文件。您可以使用<a target="_blank" rel="noopener" href="http://galeracluster.com/documentation-webpages/galeraparameters.html#gcache-dir">gcache.dir</a>参数指定写入集缓存的专用位置.</p>
<p>[^1]: Deprecated in 5.6.22-25.8 . This variable has been deprecated and shouldn’t be used as it could cause a node to crash.</p>
<p><img src="/var/folders/0g/1qch_56n4vz_3fnfp46xfq080000gn/T/abnerworks.Typora/image-20180601165051861.png" alt="image-20180601165051861"></p>
<p>当节点接收状态传输时，它们不能处理传入的写集，直到它们完成状态更新。在某些方法下，发送状态转移的节点也被阻塞。为防止数据库进一步落后，GCache将内存映射文件中的传入写入集保存到磁盘。   此参数定义要为当前环形缓冲区存储分配的磁盘空间量。节点在启动数据库服务器时分配此空间。</p>
<p>[^3]: This variable can be used to specify the size of the page files in the page storage.</p>
<p><img src="/var/folders/0g/1qch_56n4vz_3fnfp46xfq080000gn/T/abnerworks.Typora/image-20180601165332896.png" alt="image-20180601165332896"></p>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-gcache.freeze_purge_at_seqno"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/06/02/gcache.freeze_purge_at_seqno/">Want IST Not SST for Node Rejoins? We Have a Solution!</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/06/02/gcache.freeze_purge_at_seqno/" class="article-date">
	  <time datetime="2018-06-02T04:23:00.000Z" itemprop="datePublished">2018-06-02</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Want-IST-Not-SST-for-Node-Rejoins-We-Have-a-Solution"><a href="#Want-IST-Not-SST-for-Node-Rejoins-We-Have-a-Solution" class="headerlink" title="Want IST Not SST for Node Rejoins? We Have a Solution!"></a>Want IST Not SST for Node Rejoins? We Have a Solution!</h1><p><a target="_blank" rel="noopener" href="https://www.percona.com/blog/author/krunal-bauskar/">Krunal Bauskar</a> | February 13, 2018 |  Posted In: <a target="_blank" rel="noopener" href="https://www.percona.com/blog/category/high-availability/">High-availability</a>, <a target="_blank" rel="noopener" href="https://www.percona.com/blog/category/mysql/">MySQL</a>, <a target="_blank" rel="noopener" href="https://www.percona.com/blog/category/percona-xtradb-cluster/">Percona XtraDB Cluster</a></p>
<p>如果我们告诉你，有一种确定的方法可以让节点rejoin使用IST而不是SST？您可以保证新节点使用IST重新加入. 听起来很有趣？请继续阅读.</p>
<p>通常当一个节点脱离集群一段时间(处于维护目的或就是shutdown了), 集群上其他节点的gcache将用来在前者重新加入集群时提供前者在脱离期间缺失的write-set(s). 如果您配置了较大的gcache, 或downtime足够段, 则此方法可行. 对于生产环境来说, 无论是设置较大的gcache或者缩短停机窗口都不够好.</p>
<p>在停机之前在潜在的DONOR节点上重新配置gcache需要关闭节点.(gcache不能动态调整大小), Restoring it back to original size needs another shutdown. So “<strong>three shutdowns</strong>” for a single downtime. <strong>*No way …… not acceptable with busy production clusters and the possibility of more errors.*</strong></p>
<h2 id="Introducing-“gcache-freeze-purge-at-seqno”"><a href="#Introducing-“gcache-freeze-purge-at-seqno”" class="headerlink" title="Introducing “gcache.freeze_purge_at_seqno”"></a><strong>Introducing “gcache.freeze_purge_at_seqno”</strong></h2><p>基于以上痛点, 我们在<a target="_blank" rel="noopener" href="https://www.percona.com/blog/2018/01/26/percona-xtradb-cluster-5-7-20-29-24-is-now-available/">Percona XtraDB Cluster 5.7.20</a>引入了<strong>gcache.freeze_purge_at_seqno</strong>.这将控制清除gcache, 从而在节点重新加入时保留更多的数据以促进IST.</p>
<p>Galera集群世界中的所有事务都被分配了唯一的全局序列号（seqno）.跟踪事情发生使用此seqno（如wsrep_last_applied，wsrep_last_committed，wsrep_replicated，wsrep_local_cached_downto等<a target="_blank" rel="noopener" href="https://www.percona.com/doc/percona-xtradb-cluster/5.7/wsrep-status-index.html">^1</a>）.wsrep_local_cached_downto表示gcache已被清除的序列号。假设wsrep_local_cached_downto = N，那么gcache具有来自[N，wsrep_replicated]的数据, 并清除了[1，N)数据。</p>
<p>gcache.freeze_purge_at_seqno takes three values:</p>
<pre><code>1. -1(默认值): no freeze, the purge operates as normal.
2. **x (should be valid seqno in gcache):** freeze purge of write-sets &gt;= x. The best way to select x is to use the wsrep_last_applied value as an indicator from the node that you plan to shut down. (wsrep_applied * 0.09. Retain this extra 10% to trick the [safety gap heuristic algorithm of IST](https://www.percona.com/blog/2017/11/15/understanding-ist-donor-selected/).)
3. **now:** freeze purge of write-sets &amp;gt;= smallest seqno currently in gcache. Instant freeze of gcache-purge. (If tracing x (above) is difficult, simply use “now” and you are good).
</code></pre><p>在集群的现有节点上进行设置（这将继续作为集群的一部分，并可以充当潜在的捐助者）。该节点继续保留写集，从而允许重启节点使用IST重新加入。 （您可以在重启需要rejoin的节点时通过指定<code>—wsrep_sst_donor</code>将该节点作为首选DONOR进行提供）</p>
<blockquote>
<p>Set this on an existing node of the cluster (that will continue to be part of the cluster and can act as potential DONOR). This node continues to retain the write-sets, thereby allowing the restarting node to rejoin using IST. (You can feed the said node as a preferred DONOR through wsrep_sst_donor while restarting the said rejoining node.)</p>
</blockquote>
<p>请记住，一旦节点重新加入，请将其设回-1。这可以避免超出上述时间表的DONOR上的占用空间。在下一个清除周期中，所有旧的保留写入集也会被释放（回收空间回到原始状态）.</p>
<p>Note:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">To find out existing value of gcache.freeze_purge_at_seqno query wsrep_provider_options.</span><br><span class="line"><span class="keyword">select</span> @@wsrep_provider_options;</span><br><span class="line"></span><br><span class="line">To <span class="keyword">set</span> gcache.freeze_purge_at_seqno</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> wsrep_provider_options=<span class="string">&quot;gcache.freeze_purge_at_seqno = now&quot;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Why-should-you-use-it"><a href="#Why-should-you-use-it" class="headerlink" title="Why should you use it?"></a>Why should you use it?</h2><ul>
<li>gcache动态增长（使用现有的页面存储机制），并在用户将其设置回-1时收缩。这意味着您只在需要时使用(更多的)磁盘空间.</li>
<li>不需要重新启动. 用户只需专注于需要维护的节点.</li>
<li>No complex math or understanding of seqno involved (simply use “now”).</li>
<li>Less prone to error, as SST is one of the major error-prone areas with the cluster.</li>
</ul>
<p>So why wait? Give it a try! It is part of <a target="_blank" rel="noopener" href="https://www.percona.com/blog/2018/01/26/percona-xtradb-cluster-5-7-20-29-24-is-now-available/">Percona XtraDB Cluster 5.7.20</a> onwards, and helps you get IST not SST for node rejoins</p>
<p>Note: If you need more information about gcache, check <a target="_blank" rel="noopener" href="https://www.percona.com/blog/2016/11/16/all-you-need-to-know-about-gcache-galera-cache/">here</a> and <a target="_blank" rel="noopener" href="https://www.percona.com/blog/2017/11/15/understanding-ist-donor-selected/">here</a></p>

      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-PXC7种故障场景及恢复方法"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/05/29/PXC7%E7%A7%8D%E6%95%85%E9%9A%9C%E5%9C%BA%E6%99%AF%E5%8F%8A%E6%81%A2%E5%A4%8D%E6%96%B9%E6%B3%95/">[译]PXC7中故障场景及恢复方法</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/05/29/PXC7%E7%A7%8D%E6%95%85%E9%9A%9C%E5%9C%BA%E6%99%AF%E5%8F%8A%E6%81%A2%E5%A4%8D%E6%96%B9%E6%B3%95/" class="article-date">
	  <time datetime="2018-05-29T04:23:00.000Z" itemprop="datePublished">2018-05-29</time>
	</a>

      
      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>与标准的MySQL复制不同，PXC群集就像一个逻辑实体，它负责关注每个节点的状态和一致性以及群集状态。这样可以保持更好的数据完整性，然后您可以从传统的异步复制中获益，同时允许在同一时间在多个节点上进行安全写入. </p>
<p>假设我们有一个PXC集群包含3个节点</p>
<h2 id="情景1"><a href="#情景1" class="headerlink" title="情景1"></a>情景1</h2><p><img src="https://www.percona.com/blog/wp-content/uploads/2014/08/g1.png" alt="情景1"></p>
<p>节点A正常停止, 例如需要停库做一些维护, 配置变更等操作.</p>
<p>在这种情况下，其他节点从该节点接收”good bye”消息, 因此集群大小将会缩小(在这个例子中缩小为2), 并且某些属性如quorum caculation和auto increment(我理解为auto_increment_increment和auto_increment_offset会由于集群扩缩动态调整).  一旦我们重新开始的一个节点，它会根据它的my.cnf中wsrep_cluster_address设置加入群集. 这个过程与普通的复制有很大的不同 - 在A节点再次与集群完全同步之前，A节点不会接受供任何请求，因此仅仅是与集群建立连接是不够的，而是必须要先完成state transfer. 如果B或C节点的writeset cache (<a target="_blank" rel="noopener" href="https://www.percona.com/doc/percona-xtradb-cluster/5.6/wsrep-provider-index.html#gcache.size">gcache.size</a>), 仍然有恢复A节点所需的所有事务, 那么将使用<a target="_blank" rel="noopener" href="http://galeracluster.com/documentation-webpages/statetransfer.html#incremental-state-transfer-ist">IST</a> 否则使用 <a target="_blank" rel="noopener" href="https://www.percona.com/doc/percona-xtradb-cluster/5.6/manual/state_snapshot_transfer.html">SST</a> . 因此，如<a target="_blank" rel="noopener" href="https://www.percona.com/blog/2014/01/08/finding-good-ist-donor-percona-xtradb-cluster-5-6/">本文</a>所示，确定最佳donor很重要. 如果由于donor的gcache中缺少交易而导致IST不可用，则由donor作出回退决定，而SST自动启动。</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/10/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2021 Fan() All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/scripts.js"></script>



  
<script src="/js/home.js"></script>











	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Fan()
          </div>
          <div class="panel-body">
            Copyright © 2021 大范 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>